var Q=Math.PI*2,m=t=>Number.EPSILON>Math.abs(t);var v=(t,n=0,r=1)=>Math.min(Math.max(n,t),r);var P=(t,n)=>(p=1/n,Math.round(t*p)/p);var e=(t=0,n=0)=>({x:t,y:n}),c=e;e.clone=t=>e(t.x,t.y);e.fromRectXY=t=>e(t.x,t.y);e.fromRectWH=t=>e(t.w,t.h);e.fromRectRB=t=>e(t.x+t.w,t.y+t.h);e.of=t=>e(t,t);e.random=(t=1)=>e.Smul(t,e.complement(e.Smul(2,e(Math.random(),Math.random()))));e.toA=t=>[t.x,t.y];e.x=Object.freeze(e(1));e.y=Object.freeze(e(0,1));e.zero=Object.freeze(e());e.map=(t,n)=>e(t(n.x),t(n.y));e.map2=(t,n,r)=>e(t(n.x,r.x),t(n.y,r.y));e.reduce=(t,n)=>t(n.x,n.y);e.cross=()=>{throw new Error("There is no cross product in 2D")};e.project=(t,n)=>e.mulS(n,e.dot(t,n)/e.len2(n));e.reject=(t,n)=>e.sub(t,e.project(t,n));e.scalarProjection=(t,n,r)=>{let s=e.sub(t,n),i=e.normalize(e.sub(r,n)),l=e.mulS(i,e.dot(s,i));return e.add(n,l)};e.add=(t,n)=>e(t.x+n.x,t.y+n.y);e.div=(t,n)=>e(t.x/n.x,t.y/n.y);e.mul=(t,n)=>e(t.x*n.x,t.y*n.y);e.sub=(t,n)=>e(t.x-n.x,t.y-n.y);e.addS=(t,n)=>e.add(t,e.of(n));e.divS=(t,n)=>e.div(t,e.of(n));e.mulS=(t,n)=>e.mul(t,e.of(n));e.subS=(t,n)=>e.sub(t,e.of(n));e.Sadd=(t,n)=>e.add(e.of(t),n);e.Sdiv=(t,n)=>e.div(e.of(t),n);e.Smul=(t,n)=>e.mul(e.of(t),n);e.Ssub=(t,n)=>e.sub(e.of(t),n);e.dist=(t,n)=>e.len(e.sub(t,n));e.dist2=(t,n)=>e.len2(e.sub(t,n));e.dot=(t,n)=>t.x*n.x+t.y*n.y;e.equal=(t,n)=>m(e.dist2(t,n));e.len2=t=>e.dot(t,t);e.len=t=>Math.sqrt(e.dot(t,t));e.ceil=t=>e.map(Math.ceil,t);e.floor=t=>e.map(Math.floor,t);e.round=t=>e.map(Math.round,t);e.roundTo=(t,n)=>e.map2(P,t,e.of(n));e.complement=t=>e.Ssub(1,t);e.half=t=>e.divS(t,2);e.normalize=t=>e.divS(t,e.len(t));e.recip=t=>e.Sdiv(1,t);e.renormalize=(t,n,r,s,i)=>e.add(e.mul(e.div(e.sub(t,n),e.sub(r,n)),e.sub(i,s)),s);e.avg=(t,n)=>e.half(e.add(t,n));e.lerp=(t,n,r)=>e.add(t,e.Smul(r,e.sub(n,t)));e.max=(t,n)=>e.map2(Math.max,t,n);e.min=(t,n)=>e.map2(Math.min,t,n);e.abs=t=>e.map(Math.abs,t);e.invert=t=>e(-t.x,-t.y);e.invertX=t=>e(-t.x,t.y);e.invertY=t=>e(t.x,-t.y);e.midpoint=e.avg;e.intersectionPosition=(t,n,r)=>e.equal(n,r)?0:e.dist(t,n)/e.dist(n,r);e.distPointLine=(t,n,r)=>{let s=e.sub(t,n),i=e.sub(r,n),l=e.dot(s,i)/e.len2(i);l=v(l);let o=e.mulS(i,l);return e.dist(s,o)};e.distPointAABBPerimeter=(t,n)=>{t=e.sub(t,n.center),t=e.abs(t);let r=e(n.width/2,n.height/2),s=e.sub(t,r),i=e.len(e.max(s,e.zero)),l=Math.min(Math.max(s.x,s.y),0),o=i+l;return Math.abs(o)};e.closestPointOnAABBPerimeter=(t,n)=>{t=e.sub(t,n.center);let r=e(n.width/2,n.height/2),s=e.sub(t,r),i=e.len(e.max(s,e.zero)),l=Math.min(Math.max(s.x,s.y),0),o=i+l;return Math.abs(o)};e.intersectPointAABBCenter=(t,n)=>{let r=e.sub(t,n.center);t=e.abs(r);let s=e(n.width/2,n.height/2),i=e(s.x,0),l=e(s.x,s.y),o=e(0,s.y),a=e.intersectLineLine(e.zero,t,i,l),u=e.intersectLineLine(e.zero,t,l,o),d=e.len(a)<e.len(u)?a:u;return r.x!=t.x&&(d.x*=-1),r.y!=t.y&&(d.y*=-1),e.add(d,n.center)};e.intersectLineLine=(t,n,r,s)=>{let i=e.sub(n,t),l=e.sub(t,r),o=e.sub(s,r),a=o.y*i.x-o.x*i.y;if(m(a))return null;var u=(o.x*l.y-o.y*l.x)/a;return e.add(t,e.Smul(u,i))};e.intersectRayLine=(t,n,r,s)=>{let i=e.sub(s,r),l=e.sub(t,r);if(n.y/n.x==i.y/i.x)return;let o=n.x*i.y-n.y*i.x;if(o==0)return;let a=(l.y*i.x-l.x*i.y)/o,u=(l.y*n.x-l.x*n.y)/o;if(a<=0||u<=0||u>=1)return;let d=e.mulS(n,a);return e.add(t,d)};e.isInside=(t,n,r)=>n.x<=t.x&&t.x<=r.x&&n.y<=t.y&&t.y<=r.y;e.isFinite=t=>isFinite(t.x)&&isFinite(t.y);var f={pencil:[],touches:{}};window.nativeEvent=(t,n)=>{Object.entries(n).forEach(([r,s])=>{s.forEach(i=>{i.type==="pencil"?f.pencil.push({type:t,x:i.x,y:i.y}):(f.touches[r]||(f.touches[r]=[]),f.touches[r].push({type:t,x:i.x,y:i.y}))})})};var A=null;function S(){A(f),f.pencil=[],f.touches={},window.requestAnimationFrame(S)}var B=t=>{A=t,window.requestAnimationFrame(S)};var j=class{constructor(n,r){this.canvas=document.createElement("canvas"),n.appendChild(this.canvas);let s=window.devicePixelRatio,i=n.getBoundingClientRect();this.canvas.width=i.width*s,this.canvas.height=i.height*s,this.ctx=this.canvas.getContext("2d"),this.ctx.scale(s,s),this.callback=r,r(this.ctx)}render(){this.callback(this.ctx)}},I=j;var z=class{constructor(){this.pencil_down=!1,this.strokes=[],this.wet_strokes=[],this.drawing_stroke=null}begin_stroke(n){let r={input_points:[c.clone(n)],display_points:[c.clone(n)],fitted_curve:null,velocity:new T(0)};this.drawing_stroke=r,this.wet_strokes.push(r),this.strokes.push(r)}update_stroke(n){let r=this.drawing_stroke.input_points[this.drawing_stroke.input_points.length-1],s=c.dist(r,n);this.drawing_stroke.velocity.push(s),this.drawing_stroke.input_points.push(n),this.drawing_stroke.display_points.push(c.clone(n)),this.drawing_stroke.fitted_curve=O(this.drawing_stroke.input_points),this.drawing_stroke.input_points.length>3&&(this.drawing_stroke.arc=q(this.drawing_stroke.input_points));let i=this.drawing_stroke.input_points[0];c.dist(i,n)>10&&s<.075&&(this.drawing_stroke.done=!0,this.drawing_stroke=null,this.begin_stroke(n))}update(n){n.pencil.forEach(r=>{let s=c(r.x,r.y);r.type=="began"&&this.begin_stroke(s),r.type=="moved"&&this.drawing_stroke&&this.update_stroke(s),r.type=="ended"&&this.drawing_stroke&&(this.drawing_stroke.done=!0,this.drawing_stroke=null)});for(let r=0;r<this.wet_strokes.length;r++){let s=this.wet_strokes[r];if(s.fitted_curve){if(s.fitted_curve.type=="line"){let i=s.fitted_curve.line;for(let l=1;l<s.display_points.length-1;l++){let o=s.display_points[l],a=c.scalarProjection(o,i.a,i.b),u=c.sub(a,o),d=c.add(o,c.mulS(u,.1));o.x=d.x,o.y=d.y}s.done&&C(s.display_points).fitness<.1&&(s.display_points=[i.a,i.b],this.wet_strokes.splice(r,1))}else if(s.fitted_curve.type=="circle")for(let i=1;i<s.display_points.length-1;i++){let l=s.display_points[i],o=N(l,s.fitted_curve),a=c.sub(o,l),u=c.add(l,c.mulS(a,.1));l.x=u.x,l.y=u.y}}}}render(n){for(let s of this.strokes){n.strokeStyle="#000000";let i=s.display_points;n.beginPath(),n.moveTo(i[0].x,i[0].y);for(let l=1;l<i.length;l++)n.lineTo(i[l].x,i[l].y);n.stroke()}n.strokeStyle="#00000022";let r=this.wet_strokes[this.wet_strokes.length-1];if(r){let s=r.velocity.data;n.beginPath(),n.moveTo(50,s[0]*50+50);for(let i=1;i<s.length;i++)n.lineTo(50+i*2,s[i]*50+50);n.stroke()}n.beginPath(),n.moveTo(50,.75*50+50),n.lineTo(50+400,.75*50+50),n.stroke()}},R=z,T=class{constructor(n,r=.05){this.data=[n],this.filtered=n,this.alpha=r}push(n){this.filtered=this.alpha*n+(1-this.alpha)*this.filtered,this.data.push(this.filtered)}};function F(t){let n=t[0],r=t[t.length-1];var s=-1,i=-1;for(let l=0;l<t.length;l++){let o=t[l],a=Y(o,n,r);a>s&&(s=a,i=l)}return[n,t[i],r]}function Y(t,n,r){let s=c.scalarProjection(t,n,r);return c.len(c.sub(t,s))}function O(t){let n=C(t),r=q(t);return n.fitness<7?n:r}function C(t){let n=0,r={a:t[0],b:t[t.length-1]};for(let l=1;l<t.length-1;l++){let o=t[l],a=c.scalarProjection(o,r.a,r.b);n+=c.dist(a,o)}let s=c.dist(r.a,r.b),i=n/s;return{type:"line",fitness:i,line:r}}function q(t){if(t.length<3)return null;let n=F(t),[r,s,i]=n;if(!s)return null;let l=r.x,o=r.y,a=s.x,u=s.y,d=i.x,h=i.y,_=2*(l*(u-h)+a*(h-o)+d*(o-u)),y=((l*l+o*o)*(u-h)+(a*a+u*u)*(h-o)+(d*d+h*h)*(o-u))/_,x=((l*l+o*o)*(d-a)+(a*a+u*u)*(l-d)+(d*d+h*h)*(a-l))/_,w=Math.sqrt((l-y)*(l-y)+(o-x)*(o-x)),b=Math.atan2(o-x,l-y),M=Math.atan2(h-x,d-y),g={type:"circle",center:{x:y,y:x},radius:w,startAngle:b,endAngle:M},L=X(w,b,M),k=0;return t.forEach(D=>{k+=V(D,g)}),g.fitness=k/L,g}function X(t,n,r){let s=n*Math.PI/180,i=r*Math.PI/180;return t*Math.abs(i-s)}function V(t,n){let{x:r,y:s}=t,i=n.center.x,l=n.center.y,o=n.radius,u=Math.sqrt((r-i)**2+(s-l)**2)-o;return Math.abs(u)}function N(t,n){let{x:r,y:s}=t,i=n.center.x,l=n.center.y,o=n.radius,a=Math.atan2(s-l,r-i),u=i+o*Math.cos(a),d=l+o*Math.sin(a);return{x:u,y:d}}var E=new R,Z=new I(document.body,t=>{t.clearRect(0,0,window.innerWidth,window.innerHeight),E.render(t)});B(t=>{E.update(t),Z.render()});
//# sourceMappingURL=main.js.map
