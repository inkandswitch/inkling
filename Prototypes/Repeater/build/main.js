var it=Object.defineProperty;var nt=(e,t,s)=>t in e?it(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var T=(e,t,s)=>(nt(e,typeof t!="symbol"?t+"":t,s),s);var M={pencil:[],touches:{}};window.nativeEvent=(e,t)=>{Object.entries(t).forEach(([s,i])=>{i.forEach(a=>{a.type==="pencil"?M.pencil.push({type:e,x:a.x,y:a.y}):(M.touches[s]||(M.touches[s]=[]),M.touches[s].push({type:e,x:a.x,y:a.y,timestamp:a.timestamp}))})})};var R=null;function O(){R(M),M.pencil=[],M.touches={},window.requestAnimationFrame(O)}var q=e=>{R=e,window.requestAnimationFrame(O)};var H=class{constructor(t,s){this.canvas=document.createElement("canvas"),t.appendChild(this.canvas);let i=window.devicePixelRatio,a=t.getBoundingClientRect();this.canvas.width=a.width*i,this.canvas.height=a.height*i,this.ctx=this.canvas.getContext("2d"),this.ctx.scale(i,i),this.callback=s,s(this.ctx)}render(){this.callback(this.ctx)}},N=H;var ft=Math.PI*2,U=e=>Number.EPSILON>Math.abs(e);var G=(e,t)=>(p=1/t,Math.round(e*p)/p);var n=(e=0,t=0)=>({x:e,y:t}),o=n;n.clone=e=>n(e.x,e.y);n.fromRectXY=e=>n(e.x,e.y);n.fromRectWH=e=>n(e.w,e.h);n.fromRectRB=e=>n(e.x+e.w,e.y+e.h);n.of=e=>n(e,e);n.random=(e=1)=>n.Smul(e,n.complement(n.Smul(2,n(Math.random(),Math.random()))));n.toA=e=>[e.x,e.y];n.polar=(e,t)=>{let s=e*Math.PI/180;return n(t*Math.cos(s),t*Math.sin(s))};n.x=Object.freeze(n(1));n.y=Object.freeze(n(0,1));n.zero=Object.freeze(n());n.map=(e,t)=>n(e(t.x),e(t.y));n.map2=(e,t,s)=>n(e(t.x,s.x),e(t.y,s.y));n.reduce=(e,t)=>e(t.x,t.y);n.cross=(e,t)=>e.x*t.y-e.y*t.x;n.project=(e,t)=>n.mulS(t,n.dot(e,t)/n.len2(t));n.reject=(e,t)=>n.sub(e,n.project(e,t));n.scalarProjection=(e,t,s)=>{let i=n.sub(e,t),a=n.normalize(n.sub(s,t)),r=n.mulS(a,n.dot(i,a));return n.add(t,r)};n.add=(e,t)=>n(e.x+t.x,e.y+t.y);n.div=(e,t)=>n(e.x/t.x,e.y/t.y);n.mul=(e,t)=>n(e.x*t.x,e.y*t.y);n.sub=(e,t)=>n(e.x-t.x,e.y-t.y);n.addS=(e,t)=>n.add(e,n.of(t));n.divS=(e,t)=>n.div(e,n.of(t));n.mulS=(e,t)=>n.mul(e,n.of(t));n.subS=(e,t)=>n.sub(e,n.of(t));n.Sadd=(e,t)=>n.add(n.of(e),t);n.Sdiv=(e,t)=>n.div(n.of(e),t);n.Smul=(e,t)=>n.mul(n.of(e),t);n.Ssub=(e,t)=>n.sub(n.of(e),t);n.dist=(e,t)=>n.len(n.sub(e,t));n.dist2=(e,t)=>n.len2(n.sub(e,t));n.dot=(e,t)=>e.x*t.x+e.y*t.y;n.equal=(e,t)=>U(n.dist2(e,t));n.len2=e=>n.dot(e,e);n.len=e=>Math.sqrt(n.dot(e,e));n.ceil=e=>n.map(Math.ceil,e);n.floor=e=>n.map(Math.floor,e);n.round=e=>n.map(Math.round,e);n.roundTo=(e,t)=>n.map2(G,e,n.of(t));n.complement=e=>n.Ssub(1,e);n.half=e=>n.divS(e,2);n.normalize=e=>n.divS(e,n.len(e));n.recip=e=>n.Sdiv(1,e);n.renormalize=(e,t,s,i,a)=>n.add(n.mul(n.div(n.sub(e,t),n.sub(s,t)),n.sub(a,i)),i);n.avg=(e,t)=>n.half(n.add(e,t));n.lerp=(e,t,s)=>n.add(e,n.Smul(s,n.sub(t,e)));n.max=(e,t)=>n.map2(Math.max,e,t);n.min=(e,t)=>n.map2(Math.min,e,t);n.abs=e=>n.map(Math.abs,e);n.invert=e=>n(-e.x,-e.y);n.invertX=e=>n(-e.x,e.y);n.invertY=e=>n(e.x,-e.y);n.rotate90CW=e=>n(e.y,-e.x);n.rotate90CCW=e=>n(-e.y,e.x);n.angle=e=>{var t=Math.atan2(e.y,e.x),s=t*180/Math.PI;return s<0&&(s+=360),s};n.angleBetween=(e,t)=>{let s=n.dot(e,t),i=n.len(e),a=n.len(t);return Math.acos(s/(i*a))*180/Math.PI};n.angleBetweenClockwise=(e,t)=>{let s=n.dot(e,t),i=n.cross(e,t),r=Math.atan2(s,i)*(180/Math.PI);return r<0&&(r=360+r),r};n.update=(e,t)=>{e.x=t.x,e.y=t.y};var P=(e,t)=>({a:e,b:t}),b=P;P.len=e=>o.dist(e.a,e.b);P.intersect=(e,t)=>{let{a:s,b:i}=e,{a,b:r}=t,h=i.x-s.x,l=i.y-s.y,u=r.x-a.x,c=r.y-a.y,d=h*c-l*u;if(d===0)return null;let y=s.x-a.x,x=s.y-a.y,f=(y*c-x*u)/d,_=(h*x-l*y)/d;if(f>=0&&f<=1&&_>=0&&_<=1){let S=s.x+f*h,I=s.y+f*l;return{x:S,y:I}}return null};P.intersectAnywhere=(e,t)=>{let{a:s,b:i}=e,{a,b:r}=t,h=i.x-s.x,l=i.y-s.y,u=r.x-a.x,c=r.y-a.y,d=h*c-l*u;if(d===0)return null;let y=s.x-a.x,x=s.y-a.y,f=(y*c-x*u)/d,_=(h*x-l*y)/d,S=s.x+f*h,I=s.y+f*l;return{x:S,y:I}};P.getYforX=(e,t)=>{let{a:s,b:i}=e,{x:a,y:r}=s,{x:h,y:l}=i;return(l-r)/(h-a)*(t-a)+r};P.getXforY=(e,t)=>{let{a:s,b:i}=e,{x:a,y:r}=s,{x:h,y:l}=i,u=(l-r)/(h-a);return(t-r)/u+a};P.distToPoint=(e,t)=>{let{a:s,b:i}=e,a=o.sub(i,s),r=o.sub(t,s),h=o.dot(r,a)/o.dot(a,a);if(h<=0)return o.len(r);if(h>=1)return o.dist(t,i);{let l=o.add(s,o.mulS(a,h));return o.dist(t,l)}};var Z=0,$=class{constructor(t){this.id=Z++,this.pos=t||o()}render(t){t.beginPath(),t.ellipse(this.pos.x,this.pos.y,3,3,0,0,Math.PI*2),t.fill()}},Q=class{constructor(t,s){this.id=Z++,this.a=t,this.b=s}render(t,s){t.lineWidth=1,t.strokeStyle=s?"#F81ED5":"#000000",t.beginPath(),t.moveTo(this.a.pos.x,this.a.pos.y),t.lineTo(this.b.pos.x,this.b.pos.y),t.stroke()}},E=class{constructor(t){this.a=t,this.b=o.clone(t),this.last_b=o.clone(t),this.velocity=0,this.h_snap,this.v_snap,this.ref_line,this.angle_snap,this.angle_offset,this.len_snap,this.point_snap}update(t,s,i){this.b=t;let a=o.dist(this.last_b,this.b);this.last_b=o.clone(this.b),this.velocity=.05*a+(1-.05)*this.velocity,this.h_snap=!1,this.v_snap=!1,Math.abs(this.a.x-this.b.x)<10&&(this.b.x=this.a.x,this.v_snap=!0),Math.abs(this.a.y-this.b.y)<10&&(this.b.y=this.a.y,this.h_snap=!0);let r=[];this.velocity<1.5&&(s.forEach(l=>{let u=b.getXforY(this,l.pos.y),c=b.getYforX(this,l.pos.x);r.push({type:"horizontal",x:u,y:l.pos.y,snap:l},{type:"vertical",x:l.pos.x,y:c,snap:l})}),this.point_snap=!1,r.forEach(l=>{o.dist(t,l)<10&&(this.b.x=l.x,this.b.y=l.y,this.point_snap=l)}));let h=s.find(l=>o.dist(l.pos,t)<10);if(h&&(this.b=h.pos,this.point_snap={type:"coincident",snap:h}),this.len_snap=!1,this.angle_snap=!1,this.angle_offset=null,i){this.ref_line=i;let l=b.len(b(i.a.pos,i.b.pos)),u=b.len(b(this.a,this.b));Math.abs(l-u)<10&&(this.b=o.add(this.a,o.mulS(o.normalize(o.sub(this.b,this.a)),l)),this.len_snap=!0,u=l);let c=o.sub(this.a,this.b),d=o.sub(i.a.pos,i.b.pos),y=o.angle(c),x=o.angle(d),f=(y-x+360)%360,_=(Math.round(f/90)*90+360)%360;if(Math.abs(f-_)<10){let S=x+_;this.b=o.add(this.a,o.polar(180+S,u)),this.angle_snap=!0,this.angle_offset=_}}}render(t){if(t.lineWidth=1,t.strokeStyle=this.len_snap?"#F81ED5":"#000000",t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.stroke(),this.h_snap||this.v_snap||this.angle_snap){let s=o.add(this.b,o.mulS(o.sub(this.a,this.b),100)),i=o.add(this.a,o.mulS(o.sub(this.b,this.a),100));t.lineWidth=.25,t.strokeStyle="#F81ED5",t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(i.x,i.y),t.stroke()}if(this.point_snap){let s=o.add(this.b,o.mulS(o.sub(this.point_snap.snap.pos,this.b),100)),i=o.add(this.point_snap.snap.pos,o.mulS(o.sub(this.b,this.point_snap.snap.pos),100));t.lineWidth=.25,t.strokeStyle="#F81ED5",t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(i.x,i.y),t.stroke()}if(this.ref_line){let s=b.len(b(this.ref_line.a.pos,this.ref_line.b.pos)),i=o.normalize(o.sub(this.b,this.a)),a=o.add(this.a,o.mulS(i,1e4)),r=o.mulS(i,s);t.lineWidth=.25,t.strokeStyle="#F81ED5",t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(a.x,a.y),t.stroke();for(let h=0;h<10;h+=.25){let l=h%1==0?6:3,u=o.mulS(o.rotate90CCW(i),l),c=o.add(this.a,o.mulS(r,h)),d=o.add(c,u),y=o.sub(c,u);t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(y.x,y.y),t.stroke()}}}},J=class{constructor(){this.mode="draw",this.wet_stroke=null,this.ref_line=null,this.selection=[],this.points=[],this.lines=[],this.constraints=[],this.recorded_actions=[],this.last_point=null,this.repeat_preview=[],this.repeat_preview_active=!1,this.repeat_start=0,this.repeat_end=0}find_point_near(t){return this.points.find(s=>o.dist(s.pos,t)<10)}find_stroke_near(t){return this.lines.find(s=>b.distToPoint(b(s.a.pos,s.b.pos),t)<20)}begin_stroke(t){let s=this.find_point_near(t);s&&(t=s.pos),this.wet_stroke=new E(t)}update_stroke(t){this.wet_stroke&&this.wet_stroke.update(t,this.points,this.ref_line)}end_stroke(t,s){let i=this.find_point_near(this.wet_stroke.a);i||(i=new $(this.wet_stroke.a),this.points.push(i));let a=this.find_point_near(this.wet_stroke.b);a||(a=new $(this.wet_stroke.b),this.points.push(a));let r=new Q(i,a);this.lines.push(r),s!=!0&&this.recorded_actions.push({stroke:this.wet_stroke,line:r}),this.last_point=a,this.constraints.push({type:"minLength",a:r,b:5});let h=this.wet_stroke;h.v_snap&&this.constraints.push({type:"vertical",a:i,b:a}),h.h_snap&&this.constraints.push({type:"horizontal",a:i,b:a}),h.point_snap&&h.point_snap.type!="coincident"&&this.constraints.push({type:h.point_snap.type,a,b:h.point_snap.snap}),h.len_snap&&this.constraints.push({type:"length",a:r,b:h.ref_line}),h.angle_snap&&!h.v_snap&&!h.h_snap&&this.constraints.push({type:"angle",a:r,b:h.ref_line,angle:h.angle_offset}),console.log(this.constraints),this.wet_stroke=null}update(t){t.pencil.forEach(s=>{let i=o(s.x,s.y);if(this.mode==="draw")s.type==="began"?this.begin_stroke(i):s.type==="moved"?this.update_stroke(i):s.type==="ended"&&this.end_stroke(i);else if(this.mode.startsWith("move")){if(s.type==="began"&&(this.dragging=this.find_point_near(i),this.dragging)){let a=-Infinity;for(let r of this.points){let h=o.dist(this.dragging.pos,r.pos);h>a&&(a=h,this.fixedPoint=r)}}s.type==="moved"&&this.dragging&&(this.dragging.pos=i),s.type==="ended"&&(this.dragging=!1,this.fixedPoint=null)}}),Object.entries(t.touches).forEach(([s,i])=>{i.forEach(a=>{let r=o(a.x,a.y);if(a.type==="began"){let h=this.find_stroke_near(r);if(this.ref_line===h?this.ref_line=null:(this.ref_line=h,this.finger_down_time=a.timestamp),this.ref_line_id=s,o.dist(o(40,40),r)<20&&this.toggleModes(),o.dist(o(40,window.innerHeight-25),r)<20&&(this.repeat_preview_active?this.apply_speculative_repeat():(this.repeat_preview_active=!0,this.repeat_start=0,this.repeat_end=this.recorded_actions.length-1,this.speculative_repeat())),this.repeat_preview_active){let l=this.recorded_actions.length;for(let u=0;u<l;u++){let c=o(window.innerWidth/2-l*15+u*30,window.innerHeight-25);o.dist(c,r)<20&&(console.log("tap",u),u==this.repeat_start?this.repeat_start=u+1:u==this.repeat_start-1?this.repeat_start=u:u==this.repeat_end?this.repeat_end=u-1:u==this.repeat_end+1&&(this.repeat_end=u),this.speculative_repeat())}}o.dist(o(window.innerWidth-40,window.innerHeight-25),r)<20&&this.repeat_preview_active&&(this.repeat_preview_active=!1,this.repeat_preview=[])}a.type=="ended"&&a.timestamp-this.finger_down_time>1&&(this.ref_line=null)})})}toggleModes(){this.mode==="draw"?this.mode="move":this.mode==="move"?this.mode="move-v2":this.mode="draw"}speculative_repeat(){let t=this.last_point.pos;this.repeat_preview=[],this.recorded_actions.slice(this.repeat_start,this.repeat_end+1).forEach(s=>{let i=s.stroke,a=o.sub(i.b,i.a),r=o.add(t,a),h=b(t,r);h.ref_line=s.line,this.repeat_preview.push(h),t=r})}apply_speculative_repeat(){this.repeat_preview.forEach(t=>{this.wet_stroke=new E(t.a),this.wet_stroke.update(t.b,[],t.ref_line),this.end_stroke(null,!0)}),this.speculative_repeat()}repeat(){this.recorded_actions.forEach(t=>{let s=this.last_point,i=t.stroke,a=o.sub(i.b,i.a);this.wet_stroke=new E(s.pos),this.wet_stroke.update(o.add(this.wet_stroke.a,a),[],t.line),this.end_stroke(null,!0)})}render(t){let s=this.recorded_actions.slice(this.repeat_start,this.repeat_end+1);if(this.lines.forEach(i=>{let a=s.find(h=>h.line.id==i.id),r=this.repeat_preview_active?a:i===this.ref_line;i.render(t,r)}),this.points.forEach(i=>{i.render(t)}),this.wet_stroke&&this.wet_stroke.render(t),t.strokeStyle="#CCCCCC",this.repeat_preview.forEach(i=>{t.beginPath(),t.moveTo(i.a.x,i.a.y),t.lineTo(i.b.x,i.b.y),t.stroke()}),this.repeat_preview_active){let i=this.recorded_actions.length;for(let a=0;a<i;a++)t.beginPath(),t.ellipse(window.innerWidth/2-i*15+a*30,window.innerHeight-25,10,10,0,0,Math.PI*2),a>=this.repeat_start&&a<=this.repeat_end?t.fill():t.stroke()}t.strokeStyle="#000000",t.lineWidth=1,t.beginPath(),t.ellipse(40,40,20,20,0,0,Math.PI*2),this.mode==="draw"?t.fill():t.stroke(),t.fillText(this.mode,70,40),t.beginPath(),t.ellipse(40,window.innerHeight-25,20,20,0,0,Math.PI*2),t.stroke(),t.fillText("Repeat",70,window.innerHeight-24)}},tt=J;var at=!0,Y=class{constructor(t){this.value=t}toString(){return`var(${this.value})`}},A=class{constructor(t,s,i){this.v=t,this.amount=s,this.constraint=i}toString(){return`${this.v} += ${this.amount} from ${this.constraint}`}curb(t){t.vars.has(this.v)&&(this.amount=0)}isSignificant(t){return Math.abs(this.amount)>t}apply(t){this.v.value+=this.amount*t}draw(t){}},v=class{constructor(t,s,i){this.x=t,this.y=s,i!=null&&(this.color=i)}toString(){return`(${this.x.toFixed(1)}, ${this.y.toFixed(1)})`}contains(t,s){let i=Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2);return Math.pow(s.pointRadius,2)>=i}onClick(t){console.log(""+this);for(let s of relax.things)s.involves!=null&&s.involves(this)&&console.log("* "+s)}plus(t){return new v(this.x+t.x,this.y+t.y)}minus(t){return new v(this.x-t.x,this.y-t.y)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceTo(t){return this.minus(t).magnitude()}scaledBy(t){return new v(this.x*t,this.y*t)}rotatedBy(t){let s=t*Math.PI/180,i=Math.cos(s),a=Math.sin(s);return new v(this.x*i-this.y*a,this.x*a+this.y*i)}rotatedAroundBy(t,s){return t.plus(this.minus(t).rotatedBy(s))}angleWithXAxis(){return Math.atan2(this.y,this.x)*180/Math.PI}angleWithYAxis(){return this.angleWithXAxis()-90}normalized(){return this.scaledBy(1/this.magnitude())}dot(t){return this.x*t.x+this.y*t.y}clone(){return new v(this.x,this.y)}draw(t){let s=t.ctxt.fillStyle;t.ctxt.fillStyle=this.isSelected?"yellow":this.color??"cornflowerblue",t.ctxt.beginPath(),t.ctxt.arc(t.toScreenX(this.x),t.toScreenY(this.y),t.pointRadius,0,2*Math.PI),t.ctxt.closePath(),t.ctxt.fill(),this.selectionIndices&&this.selectionIndices.length>0&&t.drawSelectionIndices(this),t.ctxt.fillStyle=s}},m=class{constructor(t,s,i){this.p=t,this.amount=s,this.constraint=i}toString(){return`${this.p} += ${this.amount} from ${this.constraint}`}curb(t){t.xs.has(this.p)&&(this.amount.x=0),t.ys.has(this.p)&&(this.amount.y=0)}isSignificant(t){return this.amount.magnitude()>t}apply(t){let s=this.amount.scaledBy(t);this.p.x+=s.x,this.p.y+=s.y}draw(t){let s=this.p,i=s.plus(this.amount),a=t.toScreenX(s.x),r=t.toScreenY(s.y),h=t.toScreenX(i.x),l=t.toScreenY(i.y);if(Math.sqrt(Math.pow(a-h,2)+Math.pow(r-l,2))<.5)return;let u=t.ctxt,c=u.strokeStyle;u.strokeStyle="rgba(255,0,0,0.5)",u.beginPath(),u.moveTo(a,r),u.lineTo(h,l);let d=t.pointRadius*.8,y=h-a,x=l-r,f=Math.atan2(x,y);u.lineTo(h-d*Math.cos(f-Math.PI/6),l-d*Math.sin(f-Math.PI/6)),u.moveTo(h,l),u.lineTo(h-d*Math.cos(f+Math.PI/6),l-d*Math.sin(f+Math.PI/6)),u.closePath(),u.stroke(),u.strokeStyle=c}},W=class{constructor(t,s,i){this.p1=t,this.p2=s,i!=null&&(this.color=i)}toString(){return`Line(${this.p1}, ${this.p2})`}involves(t){return t===this.p1||t===this.p2}draw(t){let s=t.ctxt.lineWidth,i=t.ctxt.strokeStyle;t.ctxt.beginPath(),t.ctxt.moveTo(t.toScreenX(this.p1.x),t.toScreenY(this.p1.y)),t.ctxt.lineWidth=3,t.ctxt.strokeStyle=this.color??"rgba(0,0,0,0.15)",t.ctxt.lineTo(t.toScreenX(this.p2.x),t.toScreenY(this.p2.y)),t.ctxt.closePath(),t.ctxt.stroke(),t.ctxt.lineWidth=s,t.ctxt.strokeStyle=i}},B=class{constructor(){T(this,"rho",.25);T(this,"epsilon",.001);T(this,"things",new Set);T(this,"points",new Set);T(this,"lines",new Set)}add(t){return this.things.add(t),t instanceof v?this.points.add(t):t instanceof W&&this.lines.add(t),this}find(t){for(let s of this.things)if(t(s))return s;return null}findAll(t){let s=[];for(let i of this.things)t(i)&&s.push(i);return s}remove(t){return this.things.delete(t),t instanceof v?this.points.delete(t):t instanceof W&&this.lines.delete(t),this}clear(){return this.things.clear(),this.points.clear(),this.lines.clear(),this}propagateKnowns(t){for(;;){let s=!1;for(let i of this.things)if(i.propagateKnowns!=null&&i.propagateKnowns(t)){s=!0;break}if(!s)break}}runOneIteration(){for(let a of this.things)a.beforeTick!=null&&a.beforeTick(this);let t={xs:new Set,ys:new Set,vars:new Set};at&&this.propagateKnowns(t);let s=[];for(let a of this.things){if(a.calculateDeltas==null)continue;let r=a.calculateDeltas(t);for(let h of r)h.curb(t);r.some(h=>h.isSignificant(this.epsilon))&&s.push(...r)}let i;if(s.length>0){for(let a of s)a.apply(this.rho);i=!0}else i=!1;for(let a of this.things)a.afterTick!=null&&(i=a.afterTick(this)||i);return i}iterateForUpToMillis(t,s,i){let a=0,r=Date.now();for(D.nowSeconds=r/1e3;Date.now()-r<t;){s&&s(a+1);let h=this.runOneIteration(r);if(i&&i(a+1),h)a++;else break}return a}},st=B,C=class{constructor(t,s){this.v=t,this.wanted=s}involves(t){return!1}propagateKnowns(t){return t.vars.has(this.v)?!1:(this.v.value=this.wanted,t.vars.add(this.v),!0)}calculateDeltas(t){return[new A(this.v,this.wanted-this.v.value,this)]}toString(){return`FixedVar(${this.v}, ${this.wanted})`}};var K=class{constructor(t,s){this.p=t,this.wanted=s}involves(t){return t===this.p}propagateKnowns(t){let s=!1;return t.xs.has(this.p)||(this.p.x=this.wanted.x,t.xs.add(this.p),s=!0),t.ys.has(this.p)||(this.p.y=this.wanted.y,t.ys.add(this.p),s=!0),s}calculateDeltas(t){return[new m(this.p,this.wanted.minus(this.p),this)]}toString(){return`FixedPoint(${this.p}, ${this.wanted})`}drawOver(t){let s=t.ctxt,i=s.fillStyle;s.fillStyle="black",s.beginPath(),s.arc(t.toScreenX(this.wanted.x),t.toScreenY(this.wanted.y),t.pointRadius*.4,0,2*Math.PI),s.closePath(),s.fill(),s.fillStyle=i}},L=class{constructor(t){this.ps=t}involves(t){return this.ps.includes(t)}propagateKnowns(t){throw new Error("subclass responsibility")}calculateDeltas(t){throw new Error("subclass responsibility")}toString(){return`${this.constructor.name}(${this.ps.join(", ")})`}},j=class extends L{constructor(...t){super(t)}propagateKnowns(t){let s=this.ps.find(a=>t.ys.has(a))?.y;if(s==null)return!1;let i=!1;for(let a of this.ps)t.ys.has(a)||(a.y=s,t.ys.add(a),i=!0);return i}calculateDeltas(t){let s=this.ps.map(i=>i.y).reduce((i,a)=>i+a)/this.ps.length;return this.ps.map(i=>new m(i,new v(0,s-i.y),this))}drawUnder(t){if(!t.showConstraints)return;let s=t.ctxt,i=this.ps.map(h=>h.y).reduce((h,l)=>h+l)/this.ps.length,a=s.globalAlpha;s.globalAlpha=.125;let r=[5,10];s.setLineDash(r),s.beginPath(),s.moveTo(0,t.toScreenY(i)),s.lineTo(t.canvas.width,t.toScreenY(i)),s.closePath(),s.stroke(),s.globalAlpha=a,s.setLineDash([])}},F=class extends L{constructor(...t){super(t)}propagateKnowns(t){let s=this.ps.find(a=>t.xs.has(a))?.x;if(s==null)return!1;let i=!1;for(let a of this.ps)t.xs.has(a)||(a.x=s,t.xs.add(a),i=!0);return i}calculateDeltas(t){let s=this.ps.map(i=>i.x).reduce((i,a)=>i+a)/this.ps.length;return this.ps.map(i=>new m(i,new v(s-i.x,0),this))}drawUnder(t){if(!t.showConstraints)return;let s=t.ctxt,i=this.ps.map(r=>r.x).reduce((r,h)=>r+h)/this.ps.length,a=s.globalAlpha;s.globalAlpha=.125,s.setLineDash([5,10]),s.beginPath(),s.moveTo(t.toScreenX(i),0),s.lineTo(t.toScreenX(i),t.canvas.height),s.closePath(),s.stroke(),s.globalAlpha=a,s.setLineDash([])}},V=class{constructor(t,s){this.p1=t,this.p2=s}involves(t){return t===this.p1||t===this.p2}propagateKnowns(t){throw new Error("subclass responsibility")}calculateDeltas(t){throw new Error("subclass responsibility")}toString(){return`${this.constructor.name}(${this.p1}, ${this.p2})`}};var X=class extends V{constructor(t,s,i){super(t,s);this.length=i}beforeTick(t){delete this.fixedLengthConstraint;for(let s of t.things)s instanceof C&&s.v===this.length&&(this.fixedLengthConstraint=s)}propagateKnowns(t){return!t.vars.has(this.length)&&t.xs.has(this.p1)&&t.ys.has(this.p1)&&t.xs.has(this.p2)&&t.ys.has(this.p2)?(this.length.value=this.p1.distanceTo(this.p2),t.vars.add(this.length),!0):!1}calculateDeltas(t){let s=this.p2.minus(this.p1),a=(s.magnitude()-this.length.value)/3,r=s.normalized();return[new A(this.length,a,this),new m(this.p1,r.scaledBy(a),this),new m(this.p2,r.scaledBy(-a),this)]}toString(){return`Length(${this.p1}, ${this.p2}, ${this.length})`}contains(t,s){if(!s.showConstraints)return!1;let i=this.p1.x-10<t.x&&t.x<this.p2.x+10||this.p2.x-10<t.x&&t.x<this.p1.x+10,a=this.p1.y-10<t.y&&t.y<this.p2.y+10||this.p2.y-10<t.y&&t.y<this.p1.y+10;return i&&a}onClick(t){this.fixedLengthConstraint!=null?t.remove(this.fixedLengthConstraint):t.addThing(new C(this.length,this.length.value))}drawOver(t){if(!t.showConstraints)return;let s=t.ctxt,i=s.lineWidth,a=s.strokeStyle,r=s.fillStyle,h=s.font,l=s.textAlign,u=s.textBaseline;s.lineWidth=1,s.strokeStyle=s.fillStyle="rgba(0,0,255,0.2)",s.beginPath();let c=Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x),d=20,y=this.p1.x-d*Math.cos(c+Math.PI/2),x=this.p1.y-d*Math.sin(c+Math.PI/2),f=this.p2.x-d*Math.cos(c+Math.PI/2),_=this.p2.y-d*Math.sin(c+Math.PI/2),S=t.toScreenX((y+f)/2-d/2*Math.cos(c+Math.PI/2)),I=t.toScreenY((x+_)/2-d/2*Math.sin(c+Math.PI/2));s.moveTo(t.toScreenX(y+5*Math.cos(c+Math.PI/2)),t.toScreenY(x+5*Math.sin(c+Math.PI/2))),s.lineTo(t.toScreenX(y-5*Math.cos(c+Math.PI/2)),t.toScreenY(x-5*Math.sin(c+Math.PI/2))),s.moveTo(t.toScreenX(y),t.toScreenY(x)),s.lineTo(t.toScreenX(f),t.toScreenY(_)),s.moveTo(t.toScreenX(f+5*Math.cos(c+Math.PI/2)),t.toScreenY(_+5*Math.sin(c+Math.PI/2))),s.lineTo(t.toScreenX(f-5*Math.cos(c+Math.PI/2)),t.toScreenY(_-5*Math.sin(c+Math.PI/2))),s.closePath(),s.stroke(),s.textAlign="center",s.textBaseline="middle",s.font="14pt PT-sans",s.fillStyle=this.fixedLengthConstraint!=null?"rgba(0,0,255,0.4)":"rgba(255,0,0,0.4)",s.fillText(Math.round(this.length.value),S,I),s.lineWidth=i,s.strokeStyle=a,s.fillStyle=r,s.font=h,s.textAlign=l,s.textBaseline=u}},k=class extends V{constructor(t,s,i){super(t,s);this.length=i}propagateKnowns(t){return!1}calculateDeltas(t){let s=this.p2.minus(this.p1),i=s.magnitude();if(i>=this.length)return[];let a=(i-this.length)/2,r=s.normalized();return[new m(this.p1,r.scaledBy(a),this),new m(this.p2,r.scaledBy(-a),this)]}toString(){return`MinLength(${this.p1}, ${this.p2}, ${this.length})`}};var et=class{constructor(t,s,i,a){this.p1=t,this.p2=s,this.p3=i,this.p4=a}involves(t){return t===this.p1||t===this.p2||t===this.p3||t===this.p4}propagateKnowns(t){throw new Error("subclass responsibility")}calculateDeltas(t){throw new Error("subclass responsibility")}toString(){return`${this.constructor.name}(${this.p1}, ${this.p2}, ${this.p3}, ${this.p4})`}},z=class extends et{constructor(t,s,i,a,r){super(t,s,i,a);this.theta=r}propagateKnowns(t){return!1}calculateDeltas(t){let s=this.p2.minus(this.p1),i=Math.atan2(s.y,s.x),a=this.p1.plus(this.p2).scaledBy(.5),r=this.p4.minus(this.p3),h=Math.atan2(r.y,r.x),l=this.p3.plus(this.p4).scaledBy(.5),u=(i-h+2*Math.PI)%(2*Math.PI),c=(this.theta-u)%(2*Math.PI);return[new m(this.p1,this.p1.rotatedAroundBy(a,c).minus(this.p1),this),new m(this.p2,this.p2.rotatedAroundBy(a,c).minus(this.p2),this),new m(this.p3,this.p3.rotatedAroundBy(l,-c).minus(this.p3),this),new m(this.p4,this.p4.rotatedAroundBy(l,-c).minus(this.p4),this)]}currTheta(){let t=this.p2.minus(this.p1),s=Math.atan2(t.y,t.x),i=this.p4.minus(this.p3),a=Math.atan2(i.y,i.x);return s-a}};var D=class{constructor(t){this.v=t}propagateKnowns(t){return t.vars.has(this.v)?!1:(this.v.value=D.nowSeconds,t.vars.add(this.v),!0)}calculateDeltas(t){let s=D.nowSeconds-this.v.value;return[new A(this.v,s,this)]}};var w=new tt;console.log("hello world");var rt=new N(document.body,e=>{e.clearRect(0,0,window.innerWidth,window.innerHeight),w.render(e)});q(e=>{w.update(e),ht(),rt.render()});function ht(){let e=new st;ot(e);for(let t of w.constraints)lt(e,t);e.iterateForUpToMillis(15)}function ot(e){if(!w.mode.startsWith("move")||!w.dragging)return;function t(s){let i=g(s.pos);s.pos=i,e.add(new K(i,new v(i.x,i.y)))}t(w.dragging),w.mode==="move-v2"&&t(w.fixedPoint)}function lt(e,t){if(t.type==="vertical"&&(t.a.pos=g(t.a.pos),t.b.pos=g(t.b.pos),e.add(new F(t.a.pos,t.b.pos))),t.type==="horizontal"&&(t.a.pos=g(t.a.pos),t.b.pos=g(t.b.pos),e.add(new j(t.a.pos,t.b.pos))),t.type==="length"){t.a.a.pos=g(t.a.a.pos),t.a.b.pos=g(t.a.b.pos),t.b.a.pos=g(t.b.a.pos),t.b.b.pos=g(t.b.b.pos);let s=new Y(t.a.a.pos.distanceTo(t.a.b.pos));e.add(new X(t.a.a.pos,t.a.b.pos,s)),e.add(new X(t.b.a.pos,t.b.b.pos,s))}t.type==="minLength"&&(t.a.a.pos=g(t.a.a.pos),t.a.b.pos=g(t.a.b.pos),e.add(new k(t.a.a.pos,t.a.b.pos,t.b))),t.type==="angle"&&(t.a.a.pos=g(t.a.a.pos),t.a.b.pos=g(t.a.b.pos),t.b.a.pos=g(t.b.a.pos),t.b.b.pos=g(t.b.b.pos),e.add(new z(t.a.a.pos,t.a.b.pos,t.b.a.pos,t.b.b.pos,Math.PI*t.angle/180)))}function g(e){return e instanceof v?e:new v(e.x,e.y)}
//# sourceMappingURL=main.js.map
