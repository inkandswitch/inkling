var Ze=Object.defineProperty;var Qe=(s,t,e)=>t in s?Ze(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var rt=(s,t,e)=>(Qe(s,typeof t!="symbol"?t+"":t,e),e);var Z={pencil:[],touches:{}};window.nativeEvent=(s,t)=>{Object.entries(t).forEach(([e,r])=>{r.forEach(n=>{n.type==="pencil"?Z.pencil.push({type:s,x:n.x,y:n.y}):(Z.touches[e]||(Z.touches[e]=[]),Z.touches[e].push({type:s,x:n.x,y:n.y,timestamp:n.timestamp}))})})};var te=null;function ee(){te(Z),Z.pencil=[],Z.touches={},window.requestAnimationFrame(ee)}var se=s=>{te=s,window.requestAnimationFrame(ee)};var re=class{constructor(t,e){this.canvas=document.createElement("canvas"),t.appendChild(this.canvas);let r=window.devicePixelRatio,n=t.getBoundingClientRect();this.canvas.width=n.width*r,this.canvas.height=n.height*r,this.ctx=this.canvas.getContext("2d"),this.ctx.scale(r,r),this.callback=e,e(this.ctx)}render(){this.callback(this.ctx)}},ne=re;var ts=!0,St=class{constructor(t){this.value=t}toString(){return`var(${this.value})`}},ft=class{constructor(t,e,r){this.v=t,this.amount=e,this.constraint=r}toString(){return`${this.v} += ${this.amount} from ${this.constraint}`}curb(t){t.vars.has(this.v)&&(this.amount=0)}isSignificant(t){return Math.abs(this.amount)>t}apply(t){this.v.value+=this.amount*t}draw(t){}},M=class{constructor(t,e,r){this.x=t,this.y=e,r!=null&&(this.color=r)}toString(){return`(${this.x.toFixed(1)}, ${this.y.toFixed(1)})`}contains(t,e){let r=Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2);return Math.pow(e.pointRadius,2)>=r}onClick(t){console.log(""+this);for(let e of relax.things)e.involves!=null&&e.involves(this)&&console.log("* "+e)}plus(t){return new M(this.x+t.x,this.y+t.y)}minus(t){return new M(this.x-t.x,this.y-t.y)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceTo(t){return this.minus(t).magnitude()}scaledBy(t){return new M(this.x*t,this.y*t)}rotatedBy(t){let e=t*Math.PI/180,r=Math.cos(e),n=Math.sin(e);return new M(this.x*r-this.y*n,this.x*n+this.y*r)}rotatedAroundBy(t,e){return t.plus(this.minus(t).rotatedBy(e))}angleWithXAxis(){return Math.atan2(this.y,this.x)*180/Math.PI}angleWithYAxis(){return this.angleWithXAxis()-90}normalized(){return this.scaledBy(1/this.magnitude())}dot(t){return this.x*t.x+this.y*t.y}clone(){return new M(this.x,this.y)}draw(t){let e=t.ctxt.fillStyle;t.ctxt.fillStyle=this.isSelected?"yellow":this.color??"cornflowerblue",t.ctxt.beginPath(),t.ctxt.arc(t.toScreenX(this.x),t.toScreenY(this.y),t.pointRadius,0,2*Math.PI),t.ctxt.closePath(),t.ctxt.fill(),this.selectionIndices&&this.selectionIndices.length>0&&t.drawSelectionIndices(this),t.ctxt.fillStyle=e}},q=class{constructor(t,e,r){this.p=t,this.amount=e,this.constraint=r}toString(){return`${this.p} += ${this.amount} from ${this.constraint}`}curb(t){t.xs.has(this.p)&&(this.amount.x=0),t.ys.has(this.p)&&(this.amount.y=0)}isSignificant(t){return this.amount.magnitude()>t}apply(t){let e=this.amount.scaledBy(t);this.p.x+=e.x,this.p.y+=e.y}draw(t){let e=this.p,r=e.plus(this.amount),n=t.toScreenX(e.x),i=t.toScreenY(e.y),o=t.toScreenX(r.x),l=t.toScreenY(r.y);if(Math.sqrt(Math.pow(n-o,2)+Math.pow(i-l,2))<.5)return;let u=t.ctxt,d=u.strokeStyle;u.strokeStyle="rgba(255,0,0,0.5)",u.beginPath(),u.moveTo(n,i),u.lineTo(o,l);let c=t.pointRadius*.8,h=o-n,f=l-i,m=Math.atan2(f,h);u.lineTo(o-c*Math.cos(m-Math.PI/6),l-c*Math.sin(m-Math.PI/6)),u.moveTo(o,l),u.lineTo(o-c*Math.cos(m+Math.PI/6),l-c*Math.sin(m+Math.PI/6)),u.closePath(),u.stroke(),u.strokeStyle=d}},bt=class{constructor(t,e,r){this.p1=t,this.p2=e,r!=null&&(this.color=r)}toString(){return`Line(${this.p1}, ${this.p2})`}involves(t){return t===this.p1||t===this.p2}draw(t){let e=t.ctxt.lineWidth,r=t.ctxt.strokeStyle;t.ctxt.beginPath(),t.ctxt.moveTo(t.toScreenX(this.p1.x),t.toScreenY(this.p1.y)),t.ctxt.lineWidth=3,t.ctxt.strokeStyle=this.color??"rgba(0,0,0,0.15)",t.ctxt.lineTo(t.toScreenX(this.p2.x),t.toScreenY(this.p2.y)),t.ctxt.closePath(),t.ctxt.stroke(),t.ctxt.lineWidth=e,t.ctxt.strokeStyle=r}},_t=class{constructor(){rt(this,"rho",.25);rt(this,"epsilon",.001);rt(this,"things",new Set);rt(this,"points",new Set);rt(this,"lines",new Set)}add(t){return this.things.add(t),t instanceof M?this.points.add(t):t instanceof bt&&this.lines.add(t),this}find(t){for(let e of this.things)if(t(e))return e;return null}findAll(t){let e=[];for(let r of this.things)t(r)&&e.push(r);return e}remove(t){return this.things.delete(t),t instanceof M?this.points.delete(t):t instanceof bt&&this.lines.delete(t),this}clear(){return this.things.clear(),this.points.clear(),this.lines.clear(),this}propagateKnowns(t){for(;;){let e=!1;for(let r of this.things)if(r.propagateKnowns!=null&&r.propagateKnowns(t)){e=!0;break}if(!e)break}}runOneIteration(){for(let n of this.things)n.beforeTick!=null&&n.beforeTick(this);let t={xs:new Set,ys:new Set,vars:new Set};ts&&this.propagateKnowns(t);let e=[];for(let n of this.things){if(n.calculateDeltas==null)continue;let i=n.calculateDeltas(t);for(let o of i)o.curb(t);i.some(o=>o.isSignificant(this.epsilon))&&e.push(...i)}let r;if(e.length>0){for(let n of e)n.apply(this.rho);r=!0}else r=!1;for(let n of this.things)n.afterTick!=null&&(r=n.afterTick(this)||r);return r}iterateForUpToMillis(t,e,r){let n=0,i=Date.now();for(ot.nowSeconds=i/1e3;Date.now()-i<t;){e&&e(n+1);let o=this.runOneIteration(i);if(r&&r(n+1),o)n++;else break}return n}},ie=_t,wt=class{constructor(t,e){this.v=t,this.wanted=e}involves(t){return!1}propagateKnowns(t){return t.vars.has(this.v)?!1:(this.v.value=this.wanted,t.vars.add(this.v),!0)}calculateDeltas(t){return[new ft(this.v,this.wanted-this.v.value,this)]}toString(){return`FixedVar(${this.v}, ${this.wanted})`}};var At=class{constructor(t,e){this.p=t,this.wanted=e}involves(t){return t===this.p}propagateKnowns(t){let e=!1;return t.xs.has(this.p)||(this.p.x=this.wanted.x,t.xs.add(this.p),e=!0),t.ys.has(this.p)||(this.p.y=this.wanted.y,t.ys.add(this.p),e=!0),e}calculateDeltas(t){return[new q(this.p,this.wanted.minus(this.p),this)]}toString(){return`FixedPoint(${this.p}, ${this.wanted})`}drawOver(t){let e=t.ctxt,r=e.fillStyle;e.fillStyle="black",e.beginPath(),e.arc(t.toScreenX(this.wanted.x),t.toScreenY(this.wanted.y),t.pointRadius*.4,0,2*Math.PI),e.closePath(),e.fill(),e.fillStyle=r}},Pt=class{constructor(t){this.ps=t}involves(t){return this.ps.includes(t)}propagateKnowns(t){throw new Error("subclass responsibility")}calculateDeltas(t){throw new Error("subclass responsibility")}toString(){return`${this.constructor.name}(${this.ps.join(", ")})`}},Lt=class extends Pt{constructor(...t){super(t)}propagateKnowns(t){let e=this.ps.find(n=>t.ys.has(n))?.y;if(e==null)return!1;let r=!1;for(let n of this.ps)t.ys.has(n)||(n.y=e,t.ys.add(n),r=!0);return r}calculateDeltas(t){let e=this.ps.map(r=>r.y).reduce((r,n)=>r+n)/this.ps.length;return this.ps.map(r=>new q(r,new M(0,e-r.y),this))}drawUnder(t){if(!t.showConstraints)return;let e=t.ctxt,r=this.ps.map(o=>o.y).reduce((o,l)=>o+l)/this.ps.length,n=e.globalAlpha;e.globalAlpha=.125;let i=[5,10];e.setLineDash(i),e.beginPath(),e.moveTo(0,t.toScreenY(r)),e.lineTo(t.canvas.width,t.toScreenY(r)),e.closePath(),e.stroke(),e.globalAlpha=n,e.setLineDash([])}},Ot=class extends Pt{constructor(...t){super(t)}propagateKnowns(t){let e=this.ps.find(n=>t.xs.has(n))?.x;if(e==null)return!1;let r=!1;for(let n of this.ps)t.xs.has(n)||(n.x=e,t.xs.add(n),r=!0);return r}calculateDeltas(t){let e=this.ps.map(r=>r.x).reduce((r,n)=>r+n)/this.ps.length;return this.ps.map(r=>new q(r,new M(e-r.x,0),this))}drawUnder(t){if(!t.showConstraints)return;let e=t.ctxt,r=this.ps.map(i=>i.x).reduce((i,o)=>i+o)/this.ps.length,n=e.globalAlpha;e.globalAlpha=.125,e.setLineDash([5,10]),e.beginPath(),e.moveTo(t.toScreenX(r),0),e.lineTo(t.toScreenX(r),t.canvas.height),e.closePath(),e.stroke(),e.globalAlpha=n,e.setLineDash([])}},Nt=class{constructor(t,e){this.p1=t,this.p2=e}involves(t){return t===this.p1||t===this.p2}propagateKnowns(t){throw new Error("subclass responsibility")}calculateDeltas(t){throw new Error("subclass responsibility")}toString(){return`${this.constructor.name}(${this.p1}, ${this.p2})`}};var mt=class extends Nt{constructor(t,e,r){super(t,e);this.length=r}beforeTick(t){delete this.fixedLengthConstraint;for(let e of t.things)e instanceof wt&&e.v===this.length&&(this.fixedLengthConstraint=e)}propagateKnowns(t){return!t.vars.has(this.length)&&t.xs.has(this.p1)&&t.ys.has(this.p1)&&t.xs.has(this.p2)&&t.ys.has(this.p2)?(this.length.value=this.p1.distanceTo(this.p2),t.vars.add(this.length),!0):!1}calculateDeltas(t){let e=this.p2.minus(this.p1),n=(e.magnitude()-this.length.value)/3,i=e.normalized();return[new ft(this.length,n,this),new q(this.p1,i.scaledBy(n),this),new q(this.p2,i.scaledBy(-n),this)]}toString(){return`Length(${this.p1}, ${this.p2}, ${this.length})`}contains(t,e){if(!e.showConstraints)return!1;let r=this.p1.x-10<t.x&&t.x<this.p2.x+10||this.p2.x-10<t.x&&t.x<this.p1.x+10,n=this.p1.y-10<t.y&&t.y<this.p2.y+10||this.p2.y-10<t.y&&t.y<this.p1.y+10;return r&&n}onClick(t){this.fixedLengthConstraint!=null?t.remove(this.fixedLengthConstraint):t.addThing(new wt(this.length,this.length.value))}drawOver(t){if(!t.showConstraints)return;let e=t.ctxt,r=e.lineWidth,n=e.strokeStyle,i=e.fillStyle,o=e.font,l=e.textAlign,u=e.textBaseline;e.lineWidth=1,e.strokeStyle=e.fillStyle="rgba(0,0,255,0.2)",e.beginPath();let d=Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x),c=20,h=this.p1.x-c*Math.cos(d+Math.PI/2),f=this.p1.y-c*Math.sin(d+Math.PI/2),m=this.p2.x-c*Math.cos(d+Math.PI/2),y=this.p2.y-c*Math.sin(d+Math.PI/2),I=t.toScreenX((h+m)/2-c/2*Math.cos(d+Math.PI/2)),S=t.toScreenY((f+y)/2-c/2*Math.sin(d+Math.PI/2));e.moveTo(t.toScreenX(h+5*Math.cos(d+Math.PI/2)),t.toScreenY(f+5*Math.sin(d+Math.PI/2))),e.lineTo(t.toScreenX(h-5*Math.cos(d+Math.PI/2)),t.toScreenY(f-5*Math.sin(d+Math.PI/2))),e.moveTo(t.toScreenX(h),t.toScreenY(f)),e.lineTo(t.toScreenX(m),t.toScreenY(y)),e.moveTo(t.toScreenX(m+5*Math.cos(d+Math.PI/2)),t.toScreenY(y+5*Math.sin(d+Math.PI/2))),e.lineTo(t.toScreenX(m-5*Math.cos(d+Math.PI/2)),t.toScreenY(y-5*Math.sin(d+Math.PI/2))),e.closePath(),e.stroke(),e.textAlign="center",e.textBaseline="middle",e.font="14pt PT-sans",e.fillStyle=this.fixedLengthConstraint!=null?"rgba(0,0,255,0.4)":"rgba(255,0,0,0.4)",e.fillText(Math.round(this.length.value),I,S),e.lineWidth=r,e.strokeStyle=n,e.fillStyle=i,e.font=o,e.textAlign=l,e.textBaseline=u}},Rt=class extends Nt{constructor(t,e,r){super(t,e);this.length=r}propagateKnowns(t){return!1}calculateDeltas(t){let e=this.p2.minus(this.p1),r=e.magnitude();if(r>=this.length)return[];let n=(r-this.length)/2,i=e.normalized();return[new q(this.p1,i.scaledBy(n),this),new q(this.p2,i.scaledBy(-n),this)]}toString(){return`MinLength(${this.p1}, ${this.p2}, ${this.length})`}};var oe=class{constructor(t,e,r,n){this.p1=t,this.p2=e,this.p3=r,this.p4=n}involves(t){return t===this.p1||t===this.p2||t===this.p3||t===this.p4}propagateKnowns(t){throw new Error("subclass responsibility")}calculateDeltas(t){throw new Error("subclass responsibility")}toString(){return`${this.constructor.name}(${this.p1}, ${this.p2}, ${this.p3}, ${this.p4})`}},Et=class extends oe{constructor(t,e,r,n,i){super(t,e,r,n);this.theta=i}propagateKnowns(t){return!1}calculateDeltas(t){let e=this.p2.minus(this.p1),r=Math.atan2(e.y,e.x),n=this.p1.plus(this.p2).scaledBy(.5),i=this.p4.minus(this.p3),o=Math.atan2(i.y,i.x),l=this.p3.plus(this.p4).scaledBy(.5),u=(r-o+2*Math.PI)%(2*Math.PI),d=(this.theta-u)%(2*Math.PI);return[new q(this.p1,this.p1.rotatedAroundBy(n,d).minus(this.p1),this),new q(this.p2,this.p2.rotatedAroundBy(n,d).minus(this.p2),this),new q(this.p3,this.p3.rotatedAroundBy(l,-d).minus(this.p3),this),new q(this.p4,this.p4.rotatedAroundBy(l,-d).minus(this.p4),this)]}currTheta(){let t=this.p2.minus(this.p1),e=Math.atan2(t.y,t.x),r=this.p4.minus(this.p3),n=Math.atan2(r.y,r.x);return e-n}};var ot=class{constructor(t){this.v=t}propagateKnowns(t){return t.vars.has(this.v)?!1:(this.v.value=ot.nowSeconds,t.vars.add(this.v),!0)}calculateDeltas(t){let e=ot.nowSeconds-this.v.value;return[new ft(this.v,e,this)]}};var ir=Math.PI*2,ae=s=>Number.EPSILON>Math.abs(s);var le=(s,t)=>(p=1/t,Math.round(s*p)/p);var a=(s=0,t=0)=>({x:s,y:t}),g=a;a.clone=s=>a(s.x,s.y);a.fromRectXY=s=>a(s.x,s.y);a.fromRectWH=s=>a(s.w,s.h);a.fromRectRB=s=>a(s.x+s.w,s.y+s.h);a.of=s=>a(s,s);a.random=(s=1)=>a.Smul(s,a.complement(a.Smul(2,a(Math.random(),Math.random()))));a.toA=s=>[s.x,s.y];a.polar=(s,t)=>{let e=s*Math.PI/180;return a(t*Math.cos(e),t*Math.sin(e))};a.x=Object.freeze(a(1));a.y=Object.freeze(a(0,1));a.zero=Object.freeze(a());a.map=(s,t)=>a(s(t.x),s(t.y));a.map2=(s,t,e)=>a(s(t.x,e.x),s(t.y,e.y));a.reduce=(s,t)=>s(t.x,t.y);a.cross=(s,t)=>s.x*t.y-s.y*t.x;a.project=(s,t)=>a.mulS(t,a.dot(s,t)/a.len2(t));a.reject=(s,t)=>a.sub(s,a.project(s,t));a.scalarProjection=(s,t,e)=>{let r=a.sub(s,t),n=a.normalize(a.sub(e,t)),i=a.mulS(n,a.dot(r,n));return a.add(t,i)};a.add=(s,t)=>a(s.x+t.x,s.y+t.y);a.div=(s,t)=>a(s.x/t.x,s.y/t.y);a.mul=(s,t)=>a(s.x*t.x,s.y*t.y);a.sub=(s,t)=>a(s.x-t.x,s.y-t.y);a.addS=(s,t)=>a.add(s,a.of(t));a.divS=(s,t)=>a.div(s,a.of(t));a.mulS=(s,t)=>a.mul(s,a.of(t));a.subS=(s,t)=>a.sub(s,a.of(t));a.Sadd=(s,t)=>a.add(a.of(s),t);a.Sdiv=(s,t)=>a.div(a.of(s),t);a.Smul=(s,t)=>a.mul(a.of(s),t);a.Ssub=(s,t)=>a.sub(a.of(s),t);a.dist=(s,t)=>a.len(a.sub(s,t));a.dist2=(s,t)=>a.len2(a.sub(s,t));a.dot=(s,t)=>s.x*t.x+s.y*t.y;a.equal=(s,t)=>ae(a.dist2(s,t));a.len2=s=>a.dot(s,s);a.len=s=>Math.sqrt(a.dot(s,s));a.ceil=s=>a.map(Math.ceil,s);a.floor=s=>a.map(Math.floor,s);a.round=s=>a.map(Math.round,s);a.roundTo=(s,t)=>a.map2(le,s,a.of(t));a.complement=s=>a.Ssub(1,s);a.half=s=>a.divS(s,2);a.normalize=s=>a.divS(s,a.len(s));a.recip=s=>a.Sdiv(1,s);a.renormalize=(s,t,e,r,n)=>a.add(a.mul(a.div(a.sub(s,t),a.sub(e,t)),a.sub(n,r)),r);a.avg=(s,t)=>a.half(a.add(s,t));a.lerp=(s,t,e)=>a.add(s,a.Smul(e,a.sub(t,s)));a.max=(s,t)=>a.map2(Math.max,s,t);a.min=(s,t)=>a.map2(Math.min,s,t);a.abs=s=>a.map(Math.abs,s);a.invert=s=>a(-s.x,-s.y);a.invertX=s=>a(-s.x,s.y);a.invertY=s=>a(s.x,-s.y);a.rotate90CW=s=>a(s.y,-s.x);a.rotate90CCW=s=>a(-s.y,s.x);a.angle=s=>{var t=Math.atan2(s.y,s.x),e=t*180/Math.PI;return e<0&&(e+=360),e};a.angleBetween=(s,t)=>{let e=a.dot(s,t),r=a.len(s),n=a.len(t);return Math.acos(e/(r*n))*180/Math.PI};a.angleBetweenClockwise=(s,t)=>{let e=a.dot(s,t),r=a.cross(s,t),i=Math.atan2(e,r)*(180/Math.PI);return i<0&&(i=360+i),i};var Q=(s,t)=>({a:s,b:t}),K=Q;Q.len=s=>g.dist(s.a,s.b);Q.intersect=(s,t)=>{let{a:e,b:r}=s,{a:n,b:i}=t,o=r.x-e.x,l=r.y-e.y,u=i.x-n.x,d=i.y-n.y,c=o*d-l*u;if(c===0)return null;let h=e.x-n.x,f=e.y-n.y,m=(h*d-f*u)/c,y=(o*f-l*h)/c;if(m>=0&&m<=1&&y>=0&&y<=1){let I=e.x+m*o,S=e.y+m*l;return{x:I,y:S}}return null};Q.intersectAnywhere=(s,t)=>{let{a:e,b:r}=s,{a:n,b:i}=t,o=r.x-e.x,l=r.y-e.y,u=i.x-n.x,d=i.y-n.y,c=o*d-l*u;if(c===0)return null;let h=e.x-n.x,f=e.y-n.y,m=(h*d-f*u)/c,y=(o*f-l*h)/c,I=e.x+m*o,S=e.y+m*l;return{x:I,y:S}};Q.getYforX=(s,t)=>{let{a:e,b:r}=s,{x:n,y:i}=e,{x:o,y:l}=r;return(l-i)/(o-n)*(t-n)+i};Q.getXforY=(s,t)=>{let{a:e,b:r}=s,{x:n,y:i}=e,{x:o,y:l}=r,u=(l-i)/(o-n);return(t-i)/u+n};Q.distToPoint=(s,t)=>{let{a:e,b:r}=s,n=g.sub(r,e),i=g.sub(t,e),o=g.dot(i,n)/g.dot(n,n);if(o<=0)return g.len(i);if(o>=1)return g.dist(t,r);{let l=g.add(e,g.mulS(n,o));return g.dist(t,l)}};function k(s){let t=s||"";return function(){throw new Error("this method "+t+" is abstract! (it has no implementation in class "+this.constructor.name+")")}}function H(s,t){if(!s)throw new Error(t||"Assertion failed")}function Ft(s,t,e){let r;Object.defineProperty(s,t,{get(){return r||(r=e.call(this)),r}})}function es(s){return s&&Object.assign({},s)}function ue(s,t){let e=[];for(;t-- >0;)e.push(s());return e}function ce(s,t){return new Array(t+1).join(s)}function gt(s,t){return ue(()=>s,t)}function Tt(s){let t=[];for(let e=0;e<s.length;e++){let r=s[e];s.lastIndexOf(r)!==e&&t.indexOf(r)<0&&t.push(r)}return t}function he(s){let t=[];return s.forEach(e=>{t.indexOf(e)<0&&t.push(e)}),t}function tt(s){let t=s[0];return t===t.toUpperCase()}function pe(s){return!tt(s)}function de(s,t,e){let r=e||" ";return s.length<t?ce(r,t-s.length)+s:s}function et(){this.strings=[]}et.prototype.append=function(s){this.strings.push(s)};et.prototype.contents=function(){return this.strings.join("")};var Ct=s=>String.fromCodePoint(parseInt(s,16));function fe(s){if(s.charAt(0)==="\\")switch(s.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return`
`;case"r":return"\r";case"t":return"	";case"v":return"\v";case"x":return Ct(s.slice(2,4));case"u":return s.charAt(2)==="{"?Ct(s.slice(3,-1)):Ct(s.slice(2,6));default:return s.charAt(1)}else return s}function Dt(s){if(s==null)return String(s);let t=Object.prototype.toString.call(s);try{let e;return s.constructor&&s.constructor.name?e=s.constructor.name:t.indexOf("[object ")===0?e=t.slice(8,-1):e=typeof s,e+": "+JSON.stringify(String(s))}catch(e){return t}}var ss=Object.freeze({__proto__:null,abstract:k,assert:H,defineLazyProperty:Ft,clone:es,repeatFn:ue,repeatStr:ce,repeat:gt,getDuplicates:Tt,copyWithoutDuplicates:he,isSyntactic:tt,isLexical:pe,padLeft:de,StringBuffer:et,unescapeCodePoint:fe,unexpectedObjToString:Dt}),rs={Lu:/\p{Lu}/u,Ll:/\p{Ll}/u,Lt:/\p{Lt}/u,Lm:/\p{Lm}/u,Lo:/\p{Lo}/u,Nl:/\p{Nl}/u,Nd:/\p{Nd}/u,Mn:/\p{Mn}/u,Mc:/\p{Mc}/u,Pc:/\p{Pc}/u,Zs:/\p{Zs}/u,L:/\p{Letter}/u,Ltmo:/\p{Lt}|\p{Lm}|\p{Lo}/u},v=class{constructor(){if(this.constructor===v)throw new Error("PExpr cannot be instantiated -- it's abstract")}withSource(t){return t&&(this.source=t.trimmed()),this}},R=Object.create(v.prototype),E=Object.create(v.prototype),A=class extends v{constructor(t){super();this.obj=t}},L=class extends v{constructor(t,e){super();this.from=t,this.to=e,this.matchCodePoint=t.length>1||e.length>1}},O=class extends v{constructor(t){super();this.index=t}},_=class extends v{constructor(t){super();this.terms=t}},at=class extends _{constructor(t,e,r){let n=t.rules[e].body;super([r,n]);this.superGrammar=t,this.name=e,this.body=r}},lt=class extends _{constructor(t,e,r,n){let i=t.rules[e].body;super([...r,i,...n]);this.superGrammar=t,this.ruleName=e,this.expansionPos=r.length}},w=class extends v{constructor(t){super();this.factors=t}},F=class extends v{constructor(t){super();this.expr=t}},X=class extends F{},st=class extends F{},U=class extends F{};X.prototype.operator="*";st.prototype.operator="+";U.prototype.operator="?";X.prototype.minNumMatches=0;st.prototype.minNumMatches=1;U.prototype.minNumMatches=0;X.prototype.maxNumMatches=Number.POSITIVE_INFINITY;st.prototype.maxNumMatches=Number.POSITIVE_INFINITY;U.prototype.maxNumMatches=1;var T=class extends v{constructor(t){super();this.expr=t}},C=class extends v{constructor(t){super();this.expr=t}},B=class extends v{constructor(t){super();this.expr=t}},x=class extends v{constructor(t,e=[]){super();this.ruleName=t,this.args=e}isSyntactic(){return tt(this.ruleName)}toMemoKey(){return this._memoKey||Object.defineProperty(this,"_memoKey",{value:this.toString()}),this._memoKey}},P=class extends v{constructor(t){super();this.category=t,this.pattern=rs[t]}};function b(s,t){let e;return t?(e=new Error(t.getLineAndColumnMessage()+s),e.shortMessage=s,e.interval=t):e=new Error(s),e}function Mt(){return b("Interval sources don't match")}function ns(s){let t=new Error;return Object.defineProperty(t,"message",{enumerable:!0,get(){return s.message}}),Object.defineProperty(t,"shortMessage",{enumerable:!0,get(){return"Expected "+s.getExpectedText()}}),t.interval=s.getInterval(),t}function is(s,t,e){let r=t?`Grammar ${s} is not declared in namespace '${t}'`:"Undeclared grammar "+s;return b(r,e)}function os(s,t){return b("Grammar "+s.name+" is already declared in this namespace")}function as(s){return b(`Grammar '${s.name}' does not support incremental parsing`)}function me(s,t,e){return b("Rule "+s+" is not declared in grammar "+t,e)}function ls(s,t,e){return b("Cannot override rule "+s+" because it is not declared in "+t,e)}function us(s,t,e){return b("Cannot extend rule "+s+" because it is not declared in "+t,e)}function ge(s,t,e,r){let n="Duplicate declaration for rule '"+s+"' in grammar '"+t+"'";return t!==e&&(n+=" (originally declared in '"+e+"')"),b(n,r)}function ye(s,t,e,r){return b("Wrong number of parameters for rule "+s+" (expected "+t+", got "+e+")",r)}function cs(s,t,e,r){return b("Wrong number of arguments for rule "+s+" (expected "+t+", got "+e+")",r)}function ve(s,t,e){return b("Duplicate parameter names in rule "+s+": "+t.join(", "),e)}function hs(s,t){return b("Invalid parameter to rule "+s+": "+t+" has arity "+t.getArity()+", but parameter expressions must have arity 1",t.source)}var ps="NOTE: A _syntactic rule_ is a rule whose name begins with a capital letter. See https://ohmjs.org/d/svl for more details.";function ds(s,t){return b("Cannot apply syntactic rule "+s+" from here (inside a lexical context)",t.source)}function fs(s){let{ruleName:t}=s;return b(`applySyntactic is for syntactic rules, but '${t}' is a lexical rule. `+ps,s.source)}function ms(s){return b("applySyntactic is not required here (in a syntactic context)",s.source)}function xe(s,t){return b("Incorrect argument type: expected "+s,t.source)}function gs(s){return b("'...' can appear at most once in a rule body",s.source)}function ys(s){let t=s._node;H(t&&t.isNonterminal()&&t.ctorName==="escapeChar_unicodeCodePoint");let e=s.children.slice(1,-1).map(n=>n.source),r=e[0].coverageWith(...e.slice(1));return b(`U+${r.contents} is not a valid Unicode code point`,r)}function Ie(s,t){let e=t.length>0?t[t.length-1].args:[],r=s.expr.substituteParams(e),n="Nullable expression "+r+" is not allowed inside '"+s.operator+"' (possible infinite loop)";if(t.length>0){let i=t.map(o=>new x(o.ruleName,o.args)).join(`
`);n+=`
Application stack (most recent application last):
`+i}return b(n,s.expr.source)}function Se(s,t,e,r){return b("Rule "+s+" involves an alternation which has inconsistent arity (expected "+t+", got "+e+")",r.source)}function vs(s){let t=s.map(e=>e.message);return b(["Errors:"].concat(t).join(`
- `),s[0].interval)}function xs(s,t,e,r){let n=r.slice(0,-1).map(u=>{let d="  "+u[0].name+" > "+u[1];return u.length===3?d+" for '"+u[2]+"'":d}).join(`
`);n+=`
  `+t+" > "+s;let i="";s==="_iter"&&(i=[`
NOTE: as of Ohm v16, there is no default action for iteration nodes — see `,"  https://ohmjs.org/d/dsa for details."].join(`
`));let o=[`Missing semantic action for '${s}' in ${e} '${t}'.${i}`,"Action stack (most recent call last):",n].join(`
`),l=b(o);return l.name="missingSemanticAction",l}function Is(s){if(s.length===1)throw s[0];if(s.length>1)throw vs(s)}function Ss(s){let t=0;return s.map(r=>{let n=r.toString();return t=Math.max(t,n.length),n}).map(r=>de(r,t))}function be(s,t,e){let r=s.length,n=s.slice(0,e),i=s.slice(e+t.length);return(n+t+i).substr(0,r)}function bs(...s){let t=this,{offset:e}=t,{repeatStr:r}=ss,n=new et;n.append("Line "+t.lineNum+", col "+t.colNum+`:
`);let i=Ss([t.prevLine==null?0:t.lineNum-1,t.lineNum,t.nextLine==null?0:t.lineNum+1]),o=(c,h,f)=>{n.append(f+i[c]+" | "+h+`
`)};t.prevLine!=null&&o(0,t.prevLine,"  "),o(1,t.line,"> ");let l=t.line.length,u=r(" ",l+1);for(let c=0;c<s.length;++c){let h=s[c][0],f=s[c][1];H(h>=0&&h<=f,"range start must be >= 0 and <= end");let m=e-t.colNum+1;h=Math.max(0,h-m),f=Math.min(f-m,l),u=be(u,r("~",f-h),h)}let d=2+i[1].length+3;return n.append(r(" ",d)),u=be(u,"^",t.colNum-1),n.append(u.replace(/ +$/,"")+`
`),t.nextLine!=null&&o(2,t.nextLine,"  "),n.contents()}var kt=[];function _e(s){kt.push(s)}function _s(s){kt.forEach(t=>{t(s)}),kt=null}function Bt(s,t){let e=1,r=1,n=0,i=0,o=null,l=null,u=-1;for(;n<t;){let h=s.charAt(n++);h===`
`?(e++,r=1,u=i,i=n):h!=="\r"&&r++}let d=s.indexOf(`
`,i);if(d===-1)d=s.length;else{let h=s.indexOf(`
`,d+1);o=h===-1?s.slice(d):s.slice(d,h),o=o.replace(/^\r?\n/,"").replace(/\r$/,"")}u>=0&&(l=s.slice(u,i).replace(/\r?\n$/,""));let c=s.slice(i,d).replace(/\r$/,"");return{offset:t,lineNum:e,colNum:r,line:c,prevLine:l,nextLine:o,toString:bs}}function jt(s,t,...e){return Bt(s,t).toString(...e)}var we=(()=>{let s=0;return t=>""+t+s++})(),N=class{constructor(t,e,r){this.sourceString=t,this.startIdx=e,this.endIdx=r}get contents(){return this._contents===void 0&&(this._contents=this.sourceString.slice(this.startIdx,this.endIdx)),this._contents}get length(){return this.endIdx-this.startIdx}coverageWith(...t){return N.coverage(...t,this)}collapsedLeft(){return new N(this.sourceString,this.startIdx,this.startIdx)}collapsedRight(){return new N(this.sourceString,this.endIdx,this.endIdx)}getLineAndColumn(){return Bt(this.sourceString,this.startIdx)}getLineAndColumnMessage(){let t=[this.startIdx,this.endIdx];return jt(this.sourceString,this.startIdx,t)}minus(t){if(this.sourceString!==t.sourceString)throw Mt();return this.startIdx===t.startIdx&&this.endIdx===t.endIdx?[]:this.startIdx<t.startIdx&&t.endIdx<this.endIdx?[new N(this.sourceString,this.startIdx,t.startIdx),new N(this.sourceString,t.endIdx,this.endIdx)]:this.startIdx<t.endIdx&&t.endIdx<this.endIdx?[new N(this.sourceString,t.endIdx,this.endIdx)]:this.startIdx<t.startIdx&&t.startIdx<this.endIdx?[new N(this.sourceString,this.startIdx,t.startIdx)]:[this]}relativeTo(t){if(this.sourceString!==t.sourceString)throw Mt();return H(this.startIdx>=t.startIdx&&this.endIdx<=t.endIdx,"other interval does not cover this one"),new N(this.sourceString,this.startIdx-t.startIdx,this.endIdx-t.startIdx)}trimmed(){let{contents:t}=this,e=this.startIdx+t.match(/^\s*/)[0].length,r=this.endIdx-t.match(/\s*$/)[0].length;return new N(this.sourceString,e,r)}subInterval(t,e){let r=this.startIdx+t;return new N(this.sourceString,r,r+e)}};N.coverage=function(s,...t){let{startIdx:e,endIdx:r}=s;for(let n of t){if(n.sourceString!==s.sourceString)throw Mt();e=Math.min(e,n.startIdx),r=Math.max(r,n.endIdx)}return new N(s.sourceString,e,r)};var ws=65535,ut=class{constructor(t){this.source=t,this.pos=0,this.examinedLength=0}atEnd(){let t=this.pos>=this.source.length;return this.examinedLength=Math.max(this.examinedLength,this.pos+1),t}next(){let t=this.source[this.pos++];return this.examinedLength=Math.max(this.examinedLength,this.pos),t}nextCharCode(){let t=this.next();return t&&t.charCodeAt(0)}nextCodePoint(){let t=this.source.slice(this.pos++).codePointAt(0);return t>ws&&(this.pos+=1),this.examinedLength=Math.max(this.examinedLength,this.pos),t}matchString(t,e){let r;if(e){for(r=0;r<t.length;r++){let n=this.next(),i=t[r];if(n==null||n.toUpperCase()!==i.toUpperCase())return!1}return!0}for(r=0;r<t.length;r++)if(this.next()!==t[r])return!1;return!0}sourceSlice(t,e){return this.source.slice(t,e)}interval(t,e){return new N(this.source,t,e||this.pos)}},Gt=class{constructor(t,e,r,n,i,o,l){this.matcher=t,this.input=e,this.startExpr=r,this._cst=n,this._cstOffset=i,this._rightmostFailurePosition=o,this._rightmostFailures=l,this.failed()&&(Ft(this,"message",function(){let u="Expected "+this.getExpectedText();return jt(this.input,this.getRightmostFailurePosition())+u}),Ft(this,"shortMessage",function(){let u="expected "+this.getExpectedText(),d=Bt(this.input,this.getRightmostFailurePosition());return"Line "+d.lineNum+", col "+d.colNum+": "+u}))}succeeded(){return!!this._cst}failed(){return!this.succeeded()}getRightmostFailurePosition(){return this._rightmostFailurePosition}getRightmostFailures(){if(!this._rightmostFailures){this.matcher.setInput(this.input);let t=this.matcher._match(this.startExpr,{tracing:!1,positionToRecordFailures:this.getRightmostFailurePosition()});this._rightmostFailures=t.getRightmostFailures()}return this._rightmostFailures}toString(){return this.succeeded()?"[match succeeded]":"[match failed at position "+this.getRightmostFailurePosition()+"]"}getExpectedText(){if(this.succeeded())throw new Error("cannot get expected text of a successful MatchResult");let t=new et,e=this.getRightmostFailures();e=e.filter(r=>!r.isFluffy());for(let r=0;r<e.length;r++)r>0&&(r===e.length-1?t.append(e.length>2?", or ":" or "):t.append(", ")),t.append(e[r].toString());return t.contents()}getInterval(){let t=this.getRightmostFailurePosition();return new N(this.input,t,t)}},Ae=class{constructor(){this.applicationMemoKeyStack=[],this.memo={},this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,this.currentLeftRecursion=void 0}isActive(t){return this.applicationMemoKeyStack.indexOf(t.toMemoKey())>=0}enter(t){this.applicationMemoKeyStack.push(t.toMemoKey())}exit(){this.applicationMemoKeyStack.pop()}startLeftRecursion(t,e){e.isLeftRecursion=!0,e.headApplication=t,e.nextLeftRecursion=this.currentLeftRecursion,this.currentLeftRecursion=e;let{applicationMemoKeyStack:r}=this,n=r.indexOf(t.toMemoKey())+1,i=r.slice(n);e.isInvolved=function(o){return i.indexOf(o)>=0},e.updateInvolvedApplicationMemoKeys=function(){for(let o=n;o<r.length;o++){let l=r[o];this.isInvolved(l)||i.push(l)}}}endLeftRecursion(){this.currentLeftRecursion=this.currentLeftRecursion.nextLeftRecursion}shouldUseMemoizedResult(t){if(!t.isLeftRecursion)return!0;let{applicationMemoKeyStack:e}=this;for(let r=0;r<e.length;r++){let n=e[r];if(t.isInvolved(n))return!1}return!0}memoize(t,e){return this.memo[t]=e,this.maxExaminedLength=Math.max(this.maxExaminedLength,e.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,e.rightmostFailureOffset),e}clearObsoleteEntries(t,e){if(t+this.maxExaminedLength<=e)return;let{memo:r}=this;this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,Object.keys(r).forEach(n=>{let i=r[n];t+i.examinedLength>e?delete r[n]:(this.maxExaminedLength=Math.max(this.maxExaminedLength,i.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,i.rightmostFailureOffset))})}},As="✗",Ps="✓",Ls="⋅",Os="⇒",Ns="␉",Rs="␊",Es="␍",$t={succeeded:1<<0,isRootNode:1<<1,isImplicitSpaces:1<<2,isMemoized:1<<3,isHeadOfLeftRecursion:1<<4,terminatesLR:1<<5};function Fs(s){return gt(" ",s).join("")}function Ts(s,t,e){let r=Pe(s.slice(t,t+e));return r.length<e?r+gt(" ",e-r.length).join(""):r}function Pe(s){return typeof s=="string"?s.replace(/ /g,Ls).replace(/\t/g,Ns).replace(/\n/g,Rs).replace(/\r/g,Es):String(s)}var V=class{constructor(t,e,r,n,i,o,l){this.input=t,this.pos=this.pos1=e,this.pos2=r,this.source=new N(t,e,r),this.expr=n,this.bindings=o,this.children=l||[],this.terminatingLREntry=null,this._flags=i?$t.succeeded:0}get displayString(){return this.expr.toDisplayString()}clone(){return this.cloneWithExpr(this.expr)}cloneWithExpr(t){let e=new V(this.input,this.pos,this.pos2,t,this.succeeded,this.bindings,this.children);return e.isHeadOfLeftRecursion=this.isHeadOfLeftRecursion,e.isImplicitSpaces=this.isImplicitSpaces,e.isMemoized=this.isMemoized,e.isRootNode=this.isRootNode,e.terminatesLR=this.terminatesLR,e.terminatingLREntry=this.terminatingLREntry,e}recordLRTermination(t,e){this.terminatingLREntry=new V(this.input,this.pos,this.pos2,this.expr,!1,[e],[t]),this.terminatingLREntry.terminatesLR=!0}walk(t,e){let r=t;typeof r=="function"&&(r={enter:r});function n(i,o,l){let u=!0;r.enter&&r.enter.call(e,i,o,l)===V.prototype.SKIP&&(u=!1),u&&(i.children.forEach(d=>{n(d,i,l+1)}),r.exit&&r.exit.call(e,i,o,l))}this.isRootNode?this.children.forEach(i=>{n(i,null,0)}):n(this,null,0)}toString(){let t=new et;return this.walk((e,r,n)=>{if(!e)return this.SKIP;if(e.expr.constructor.name!=="Alt"){if(t.append(Ts(e.input,e.pos,10)+Fs(n*2+1)),t.append((e.succeeded?Ps:As)+" "+e.displayString),e.isHeadOfLeftRecursion&&t.append(" (LR)"),e.succeeded){let o=Pe(e.source.contents);t.append(" "+Os+"  "),t.append(typeof o=="string"?'"'+o+'"':o)}t.append(`
`)}}),t.contents()}};V.prototype.SKIP={};Object.keys($t).forEach(s=>{let t=$t[s];Object.defineProperty(V.prototype,s,{get(){return(this._flags&t)!=0},set(e){e?this._flags|=t:this._flags&=~t}})});v.prototype.allowsSkippingPrecedingSpace=k("allowsSkippingPrecedingSpace");R.allowsSkippingPrecedingSpace=E.allowsSkippingPrecedingSpace=x.prototype.allowsSkippingPrecedingSpace=A.prototype.allowsSkippingPrecedingSpace=L.prototype.allowsSkippingPrecedingSpace=P.prototype.allowsSkippingPrecedingSpace=function(){return!0};_.prototype.allowsSkippingPrecedingSpace=F.prototype.allowsSkippingPrecedingSpace=B.prototype.allowsSkippingPrecedingSpace=C.prototype.allowsSkippingPrecedingSpace=T.prototype.allowsSkippingPrecedingSpace=O.prototype.allowsSkippingPrecedingSpace=w.prototype.allowsSkippingPrecedingSpace=function(){return!1};var ct;_e(s=>{ct=s});var yt;v.prototype.assertAllApplicationsAreValid=function(s,t){yt=0,this._assertAllApplicationsAreValid(s,t)};v.prototype._assertAllApplicationsAreValid=k("_assertAllApplicationsAreValid");R._assertAllApplicationsAreValid=E._assertAllApplicationsAreValid=A.prototype._assertAllApplicationsAreValid=L.prototype._assertAllApplicationsAreValid=O.prototype._assertAllApplicationsAreValid=P.prototype._assertAllApplicationsAreValid=function(s,t){};B.prototype._assertAllApplicationsAreValid=function(s,t){yt++,this.expr._assertAllApplicationsAreValid(s,t),yt--};_.prototype._assertAllApplicationsAreValid=function(s,t){for(let e=0;e<this.terms.length;e++)this.terms[e]._assertAllApplicationsAreValid(s,t)};w.prototype._assertAllApplicationsAreValid=function(s,t){for(let e=0;e<this.factors.length;e++)this.factors[e]._assertAllApplicationsAreValid(s,t)};F.prototype._assertAllApplicationsAreValid=T.prototype._assertAllApplicationsAreValid=C.prototype._assertAllApplicationsAreValid=function(s,t){this.expr._assertAllApplicationsAreValid(s,t)};x.prototype._assertAllApplicationsAreValid=function(s,t,e=!1){let r=t.rules[this.ruleName],n=tt(s)&&yt===0;if(!r)throw me(this.ruleName,t.name,this.source);if(!e&&tt(this.ruleName)&&!n)throw ds(this.ruleName,this);let i=this.args.length,o=r.formals.length;if(i!==o)throw cs(this.ruleName,o,i,this.source);let l=ct&&r===ct.rules.applySyntactic;if(ct&&r===ct.rules.caseInsensitive&&!(this.args[0]instanceof A))throw xe('a Terminal (e.g. "abc")',this.args[0]);if(l){let d=this.args[0];if(!(d instanceof x))throw xe("a syntactic rule application",d);if(!tt(d.ruleName))throw fs(d);if(n)throw ms(this)}this.args.forEach(d=>{if(d._assertAllApplicationsAreValid(s,t,l),d.getArity()!==1)throw hs(this.ruleName,d)})};v.prototype.assertChoicesHaveUniformArity=k("assertChoicesHaveUniformArity");R.assertChoicesHaveUniformArity=E.assertChoicesHaveUniformArity=A.prototype.assertChoicesHaveUniformArity=L.prototype.assertChoicesHaveUniformArity=O.prototype.assertChoicesHaveUniformArity=B.prototype.assertChoicesHaveUniformArity=P.prototype.assertChoicesHaveUniformArity=function(s){};_.prototype.assertChoicesHaveUniformArity=function(s){if(this.terms.length===0)return;let t=this.terms[0].getArity();for(let e=0;e<this.terms.length;e++){let r=this.terms[e];r.assertChoicesHaveUniformArity();let n=r.getArity();if(t!==n)throw Se(s,t,n,r)}};at.prototype.assertChoicesHaveUniformArity=function(s){let t=this.terms[0].getArity(),e=this.terms[1].getArity();if(t!==e)throw Se(s,e,t,this.terms[0])};w.prototype.assertChoicesHaveUniformArity=function(s){for(let t=0;t<this.factors.length;t++)this.factors[t].assertChoicesHaveUniformArity(s)};F.prototype.assertChoicesHaveUniformArity=function(s){this.expr.assertChoicesHaveUniformArity(s)};T.prototype.assertChoicesHaveUniformArity=function(s){};C.prototype.assertChoicesHaveUniformArity=function(s){this.expr.assertChoicesHaveUniformArity(s)};x.prototype.assertChoicesHaveUniformArity=function(s){};v.prototype.assertIteratedExprsAreNotNullable=k("assertIteratedExprsAreNotNullable");R.assertIteratedExprsAreNotNullable=E.assertIteratedExprsAreNotNullable=A.prototype.assertIteratedExprsAreNotNullable=L.prototype.assertIteratedExprsAreNotNullable=O.prototype.assertIteratedExprsAreNotNullable=P.prototype.assertIteratedExprsAreNotNullable=function(s){};_.prototype.assertIteratedExprsAreNotNullable=function(s){for(let t=0;t<this.terms.length;t++)this.terms[t].assertIteratedExprsAreNotNullable(s)};w.prototype.assertIteratedExprsAreNotNullable=function(s){for(let t=0;t<this.factors.length;t++)this.factors[t].assertIteratedExprsAreNotNullable(s)};F.prototype.assertIteratedExprsAreNotNullable=function(s){if(this.expr.assertIteratedExprsAreNotNullable(s),this.expr.isNullable(s))throw Ie(this,[])};U.prototype.assertIteratedExprsAreNotNullable=T.prototype.assertIteratedExprsAreNotNullable=C.prototype.assertIteratedExprsAreNotNullable=B.prototype.assertIteratedExprsAreNotNullable=function(s){this.expr.assertIteratedExprsAreNotNullable(s)};x.prototype.assertIteratedExprsAreNotNullable=function(s){this.args.forEach(t=>{t.assertIteratedExprsAreNotNullable(s)})};var vt=class{constructor(t){this.matchLength=t}get ctorName(){throw new Error("subclass responsibility")}numChildren(){return this.children?this.children.length:0}childAt(t){if(this.children)return this.children[t]}indexOfChild(t){return this.children.indexOf(t)}hasChildren(){return this.numChildren()>0}hasNoChildren(){return!this.hasChildren()}onlyChild(){if(this.numChildren()!==1)throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)");return this.firstChild()}firstChild(){if(this.hasNoChildren())throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children");return this.childAt(0)}lastChild(){if(this.hasNoChildren())throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children");return this.childAt(this.numChildren()-1)}childBefore(t){let e=this.indexOfChild(t);if(e<0)throw new Error("Node.childBefore() called w/ an argument that is not a child");if(e===0)throw new Error("cannot get child before first child");return this.childAt(e-1)}childAfter(t){let e=this.indexOfChild(t);if(e<0)throw new Error("Node.childAfter() called w/ an argument that is not a child");if(e===this.numChildren()-1)throw new Error("cannot get child after last child");return this.childAt(e+1)}isTerminal(){return!1}isNonterminal(){return!1}isIteration(){return!1}isOptional(){return!1}},Y=class extends vt{get ctorName(){return"_terminal"}isTerminal(){return!0}get primitiveValue(){throw new Error("The `primitiveValue` property was removed in Ohm v17.")}},Le=class extends vt{constructor(t,e,r,n){super(n);this.ruleName=t,this.children=e,this.childOffsets=r}get ctorName(){return this.ruleName}isNonterminal(){return!0}isLexical(){return pe(this.ctorName)}isSyntactic(){return tt(this.ctorName)}},qt=class extends vt{constructor(t,e,r,n){super(r);this.children=t,this.childOffsets=e,this.optional=n}get ctorName(){return"_iter"}isIteration(){return!0}isOptional(){return this.optional}};v.prototype.eval=k("eval");R.eval=function(s){let{inputStream:t}=s,e=t.pos,r=t.nextCodePoint();return r!==void 0?(s.pushBinding(new Y(String.fromCodePoint(r).length),e),!0):(s.processFailure(e,this),!1)};E.eval=function(s){let{inputStream:t}=s,e=t.pos;return t.atEnd()?(s.pushBinding(new Y(0),e),!0):(s.processFailure(e,this),!1)};A.prototype.eval=function(s){let{inputStream:t}=s,e=t.pos;return t.matchString(this.obj)?(s.pushBinding(new Y(this.obj.length),e),!0):(s.processFailure(e,this),!1)};L.prototype.eval=function(s){let{inputStream:t}=s,e=t.pos,r=this.matchCodePoint?t.nextCodePoint():t.nextCharCode();return r!==void 0&&this.from.codePointAt(0)<=r&&r<=this.to.codePointAt(0)?(s.pushBinding(new Y(String.fromCodePoint(r).length),e),!0):(s.processFailure(e,this),!1)};O.prototype.eval=function(s){return s.eval(s.currentApplication().args[this.index])};B.prototype.eval=function(s){s.enterLexifiedContext();let t=s.eval(this.expr);return s.exitLexifiedContext(),t};_.prototype.eval=function(s){for(let t=0;t<this.terms.length;t++)if(s.eval(this.terms[t]))return!0;return!1};w.prototype.eval=function(s){for(let t=0;t<this.factors.length;t++){let e=this.factors[t];if(!s.eval(e))return!1}return!0};F.prototype.eval=function(s){let{inputStream:t}=s,e=t.pos,r=this.getArity(),n=[],i=[];for(;n.length<r;)n.push([]),i.push([]);let o=0,l=e,u;for(;o<this.maxNumMatches&&s.eval(this.expr);){if(t.pos===l)throw Ie(this,s._applicationStack);l=t.pos,o++;let f=s._bindings.splice(s._bindings.length-r,r),m=s._bindingOffsets.splice(s._bindingOffsets.length-r,r);for(u=0;u<f.length;u++)n[u].push(f[u]),i[u].push(m[u])}if(o<this.minNumMatches)return!1;let d=s.posToOffset(e),c=0;if(o>0){let f=n[r-1],m=i[r-1],y=m[m.length-1]+f[f.length-1].matchLength;d=i[0][0],c=y-d}let h=this instanceof U;for(u=0;u<n.length;u++)s._bindings.push(new qt(n[u],i[u],c,h)),s._bindingOffsets.push(d);return!0};T.prototype.eval=function(s){let{inputStream:t}=s,e=t.pos;s.pushFailuresInfo();let r=s.eval(this.expr);return s.popFailuresInfo(),r?(s.processFailure(e,this),!1):(t.pos=e,!0)};C.prototype.eval=function(s){let{inputStream:t}=s,e=t.pos;return s.eval(this.expr)?(t.pos=e,!0):!1};x.prototype.eval=function(s){let t=s.currentApplication(),e=t?t.args:[],r=this.substituteParams(e),n=s.getCurrentPosInfo();if(n.isActive(r))return r.handleCycle(s);let i=r.toMemoKey(),o=n.memo[i];if(o&&n.shouldUseMemoizedResult(o)){if(s.hasNecessaryInfo(o))return s.useMemoizedResult(s.inputStream.pos,o);delete n.memo[i]}return r.reallyEval(s)};x.prototype.handleCycle=function(s){let t=s.getCurrentPosInfo(),{currentLeftRecursion:e}=t,r=this.toMemoKey(),n=t.memo[r];return e&&e.headApplication.toMemoKey()===r?n.updateInvolvedApplicationMemoKeys():n||(n=t.memoize(r,{matchLength:0,examinedLength:0,value:!1,rightmostFailureOffset:-1}),t.startLeftRecursion(this,n)),s.useMemoizedResult(s.inputStream.pos,n)};x.prototype.reallyEval=function(s){let{inputStream:t}=s,e=t.pos,r=s.getCurrentPosInfo(),n=s.grammar.rules[this.ruleName],{body:i}=n,{description:o}=n;s.enterApplication(r,this),o&&s.pushFailuresInfo();let l=t.examinedLength;t.examinedLength=0;let u=this.evalOnce(i,s),d=r.currentLeftRecursion,c=this.toMemoKey(),h=d&&d.headApplication.toMemoKey()===c,f;s.doNotMemoize?s.doNotMemoize=!1:h?(u=this.growSeedResult(i,s,e,d,u),r.endLeftRecursion(),f=d,f.examinedLength=t.examinedLength-e,f.rightmostFailureOffset=s._getRightmostFailureOffset(),r.memoize(c,f)):(!d||!d.isInvolved(c))&&(f=r.memoize(c,{matchLength:t.pos-e,examinedLength:t.examinedLength-e,value:u,failuresAtRightmostPosition:s.cloneRecordedFailures(),rightmostFailureOffset:s._getRightmostFailureOffset()}));let m=!!u;if(o&&(s.popFailuresInfo(),m||s.processFailure(e,this),f&&(f.failuresAtRightmostPosition=s.cloneRecordedFailures())),s.isTracing()&&f){let y=s.getTraceEntry(e,this,m,m?[u]:[]);h&&(H(y.terminatingLREntry!=null||!m),y.isHeadOfLeftRecursion=!0),f.traceEntry=y}return t.examinedLength=Math.max(t.examinedLength,l),s.exitApplication(r,u),m};x.prototype.evalOnce=function(s,t){let{inputStream:e}=t,r=e.pos;if(t.eval(s)){let n=s.getArity(),i=t._bindings.splice(t._bindings.length-n,n),o=t._bindingOffsets.splice(t._bindingOffsets.length-n,n),l=e.pos-r;return new Le(this.ruleName,i,o,l)}else return!1};x.prototype.growSeedResult=function(s,t,e,r,n){if(!n)return!1;let{inputStream:i}=t;for(;;){if(r.matchLength=i.pos-e,r.value=n,r.failuresAtRightmostPosition=t.cloneRecordedFailures(),t.isTracing()){let o=t.trace[t.trace.length-1];r.traceEntry=new V(t.input,e,i.pos,this,!0,[n],[o.clone()])}if(i.pos=e,n=this.evalOnce(s,t),i.pos-e<=r.matchLength)break;t.isTracing()&&t.trace.splice(-2,1)}return t.isTracing()&&r.traceEntry.recordLRTermination(t.trace.pop(),n),i.pos=e+r.matchLength,r.value};P.prototype.eval=function(s){let{inputStream:t}=s,e=t.pos,r=t.next();return r&&this.pattern.test(r)?(s.pushBinding(new Y(r.length),e),!0):(s.processFailure(e,this),!1)};v.prototype.getArity=k("getArity");R.getArity=E.getArity=A.prototype.getArity=L.prototype.getArity=O.prototype.getArity=x.prototype.getArity=P.prototype.getArity=function(){return 1};_.prototype.getArity=function(){return this.terms.length===0?0:this.terms[0].getArity()};w.prototype.getArity=function(){let s=0;for(let t=0;t<this.factors.length;t++)s+=this.factors[t].getArity();return s};F.prototype.getArity=function(){return this.expr.getArity()};T.prototype.getArity=function(){return 0};C.prototype.getArity=B.prototype.getArity=function(){return this.expr.getArity()};function z(s,t){let e={};if(s.source&&t){let r=s.source.relativeTo(t);e.sourceInterval=[r.startIdx,r.endIdx]}return e}v.prototype.outputRecipe=k("outputRecipe");R.outputRecipe=function(s,t){return["any",z(this,t)]};E.outputRecipe=function(s,t){return["end",z(this,t)]};A.prototype.outputRecipe=function(s,t){return["terminal",z(this,t),this.obj]};L.prototype.outputRecipe=function(s,t){return["range",z(this,t),this.from,this.to]};O.prototype.outputRecipe=function(s,t){return["param",z(this,t),this.index]};_.prototype.outputRecipe=function(s,t){return["alt",z(this,t)].concat(this.terms.map(e=>e.outputRecipe(s,t)))};at.prototype.outputRecipe=function(s,t){return this.terms[0].outputRecipe(s,t)};lt.prototype.outputRecipe=function(s,t){let e=this.terms.slice(0,this.expansionPos),r=this.terms.slice(this.expansionPos+1);return["splice",z(this,t),e.map(n=>n.outputRecipe(s,t)),r.map(n=>n.outputRecipe(s,t))]};w.prototype.outputRecipe=function(s,t){return["seq",z(this,t)].concat(this.factors.map(e=>e.outputRecipe(s,t)))};X.prototype.outputRecipe=st.prototype.outputRecipe=U.prototype.outputRecipe=T.prototype.outputRecipe=C.prototype.outputRecipe=B.prototype.outputRecipe=function(s,t){return[this.constructor.name.toLowerCase(),z(this,t),this.expr.outputRecipe(s,t)]};x.prototype.outputRecipe=function(s,t){return["app",z(this,t),this.ruleName,this.args.map(e=>e.outputRecipe(s,t))]};P.prototype.outputRecipe=function(s,t){return["unicodeChar",z(this,t),this.category]};v.prototype.introduceParams=k("introduceParams");R.introduceParams=E.introduceParams=A.prototype.introduceParams=L.prototype.introduceParams=O.prototype.introduceParams=P.prototype.introduceParams=function(s){return this};_.prototype.introduceParams=function(s){return this.terms.forEach((t,e,r)=>{r[e]=t.introduceParams(s)}),this};w.prototype.introduceParams=function(s){return this.factors.forEach((t,e,r)=>{r[e]=t.introduceParams(s)}),this};F.prototype.introduceParams=T.prototype.introduceParams=C.prototype.introduceParams=B.prototype.introduceParams=function(s){return this.expr=this.expr.introduceParams(s),this};x.prototype.introduceParams=function(s){let t=s.indexOf(this.ruleName);if(t>=0){if(this.args.length>0)throw new Error("Parameterized rules cannot be passed as arguments to another rule.");return new O(t).withSource(this.source)}else return this.args.forEach((e,r,n)=>{n[r]=e.introduceParams(s)}),this};v.prototype.isNullable=function(s){return this._isNullable(s,Object.create(null))};v.prototype._isNullable=k("_isNullable");R._isNullable=L.prototype._isNullable=O.prototype._isNullable=st.prototype._isNullable=P.prototype._isNullable=function(s,t){return!1};E._isNullable=function(s,t){return!0};A.prototype._isNullable=function(s,t){return typeof this.obj=="string"?this.obj==="":!1};_.prototype._isNullable=function(s,t){return this.terms.length===0||this.terms.some(e=>e._isNullable(s,t))};w.prototype._isNullable=function(s,t){return this.factors.every(e=>e._isNullable(s,t))};X.prototype._isNullable=U.prototype._isNullable=T.prototype._isNullable=C.prototype._isNullable=function(s,t){return!0};B.prototype._isNullable=function(s,t){return this.expr._isNullable(s,t)};x.prototype._isNullable=function(s,t){let e=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(t,e)){let{body:r}=s.rules[this.ruleName],n=r.substituteParams(this.args);t[e]=!1,t[e]=n._isNullable(s,t)}return t[e]};v.prototype.substituteParams=k("substituteParams");R.substituteParams=E.substituteParams=A.prototype.substituteParams=L.prototype.substituteParams=P.prototype.substituteParams=function(s){return this};O.prototype.substituteParams=function(s){return s[this.index]};_.prototype.substituteParams=function(s){return new _(this.terms.map(t=>t.substituteParams(s)))};w.prototype.substituteParams=function(s){return new w(this.factors.map(t=>t.substituteParams(s)))};F.prototype.substituteParams=T.prototype.substituteParams=C.prototype.substituteParams=B.prototype.substituteParams=function(s){return new this.constructor(this.expr.substituteParams(s))};x.prototype.substituteParams=function(s){if(this.args.length===0)return this;{let t=this.args.map(e=>e.substituteParams(s));return new x(this.ruleName,t)}};function Oe(s){return/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(s)}function Kt(s){let t=Object.create(null);s.forEach(e=>{t[e]=(t[e]||0)+1}),Object.keys(t).forEach(e=>{if(t[e]<=1)return;let r=1;s.forEach((n,i)=>{n===e&&(s[i]=n+"_"+r++)})})}v.prototype.toArgumentNameList=k("toArgumentNameList");R.toArgumentNameList=function(s,t){return["any"]};E.toArgumentNameList=function(s,t){return["end"]};A.prototype.toArgumentNameList=function(s,t){return typeof this.obj=="string"&&/^[_a-zA-Z0-9]+$/.test(this.obj)?["_"+this.obj]:["$"+s]};L.prototype.toArgumentNameList=function(s,t){let e=this.from+"_to_"+this.to;return Oe(e)||(e="_"+e),Oe(e)||(e="$"+s),[e]};_.prototype.toArgumentNameList=function(s,t){let e=this.terms.map(i=>i.toArgumentNameList(s,!0)),r=[],n=e[0].length;for(let i=0;i<n;i++){let o=[];for(let u=0;u<this.terms.length;u++)o.push(e[u][i]);let l=he(o);r.push(l.join("_or_"))}return t||Kt(r),r};w.prototype.toArgumentNameList=function(s,t){let e=[];return this.factors.forEach(r=>{let n=r.toArgumentNameList(s,!0);e=e.concat(n),s+=n.length}),t||Kt(e),e};F.prototype.toArgumentNameList=function(s,t){let e=this.expr.toArgumentNameList(s,t).map(r=>r[r.length-1]==="s"?r+"es":r+"s");return t||Kt(e),e};U.prototype.toArgumentNameList=function(s,t){return this.expr.toArgumentNameList(s,t).map(e=>"opt"+e[0].toUpperCase()+e.slice(1))};T.prototype.toArgumentNameList=function(s,t){return[]};C.prototype.toArgumentNameList=B.prototype.toArgumentNameList=function(s,t){return this.expr.toArgumentNameList(s,t)};x.prototype.toArgumentNameList=function(s,t){return[this.ruleName]};P.prototype.toArgumentNameList=function(s,t){return["$"+s]};O.prototype.toArgumentNameList=function(s,t){return["param"+this.index]};v.prototype.toDisplayString=k("toDisplayString");_.prototype.toDisplayString=w.prototype.toDisplayString=function(){return this.source?this.source.trimmed().contents:"["+this.constructor.name+"]"};R.toDisplayString=E.toDisplayString=F.prototype.toDisplayString=T.prototype.toDisplayString=C.prototype.toDisplayString=B.prototype.toDisplayString=A.prototype.toDisplayString=L.prototype.toDisplayString=O.prototype.toDisplayString=function(){return this.toString()};x.prototype.toDisplayString=function(){if(this.args.length>0){let s=this.args.map(t=>t.toDisplayString());return this.ruleName+"<"+s.join(",")+">"}else return this.ruleName};P.prototype.toDisplayString=function(){return"Unicode ["+this.category+"] character"};function Cs(s){return s==="description"||s==="string"||s==="code"}var j=class{constructor(t,e,r){if(!Cs(r))throw new Error("invalid Failure type: "+r);this.pexpr=t,this.text=e,this.type=r,this.fluffy=!1}getPExpr(){return this.pexpr}getText(){return this.text}getType(){return this.type}isDescription(){return this.type==="description"}isStringTerminal(){return this.type==="string"}isCode(){return this.type==="code"}isFluffy(){return this.fluffy}makeFluffy(){this.fluffy=!0}clearFluffy(){this.fluffy=!1}subsumes(t){return this.getText()===t.getText()&&this.type===t.type&&(!this.isFluffy()||this.isFluffy()&&t.isFluffy())}toString(){return this.type==="string"?JSON.stringify(this.getText()):this.getText()}clone(){let t=new j(this.pexpr,this.text,this.type);return this.isFluffy()&&t.makeFluffy(),t}toKey(){return this.toString()+"#"+this.type}};v.prototype.toFailure=k("toFailure");R.toFailure=function(s){return new j(this,"any object","description")};E.toFailure=function(s){return new j(this,"end of input","description")};A.prototype.toFailure=function(s){return new j(this,this.obj,"string")};L.prototype.toFailure=function(s){return new j(this,JSON.stringify(this.from)+".."+JSON.stringify(this.to),"code")};T.prototype.toFailure=function(s){let t=this.expr===R?"nothing":"not "+this.expr.toFailure(s);return new j(this,t,"description")};C.prototype.toFailure=function(s){return this.expr.toFailure(s)};x.prototype.toFailure=function(s){let{description:t}=s.rules[this.ruleName];return t||(t=(/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a")+" "+this.ruleName),new j(this,t,"description")};P.prototype.toFailure=function(s){return new j(this,"a Unicode ["+this.category+"] character","description")};_.prototype.toFailure=function(s){let t=this.terms.map(r=>r.toFailure(s)),e="("+t.join(" or ")+")";return new j(this,e,"description")};w.prototype.toFailure=function(s){let t=this.factors.map(r=>r.toFailure(s)),e="("+t.join(" ")+")";return new j(this,e,"description")};F.prototype.toFailure=function(s){let t="("+this.expr.toFailure(s)+this.operator+")";return new j(this,t,"description")};v.prototype.toString=k("toString");R.toString=function(){return"any"};E.toString=function(){return"end"};A.prototype.toString=function(){return JSON.stringify(this.obj)};L.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)};O.prototype.toString=function(){return"$"+this.index};B.prototype.toString=function(){return"#("+this.expr.toString()+")"};_.prototype.toString=function(){return this.terms.length===1?this.terms[0].toString():"("+this.terms.map(s=>s.toString()).join(" | ")+")"};w.prototype.toString=function(){return this.factors.length===1?this.factors[0].toString():"("+this.factors.map(s=>s.toString()).join(" ")+")"};F.prototype.toString=function(){return this.expr+this.operator};T.prototype.toString=function(){return"~"+this.expr};C.prototype.toString=function(){return"&"+this.expr};x.prototype.toString=function(){if(this.args.length>0){let s=this.args.map(t=>t.toString());return this.ruleName+"<"+s.join(",")+">"}else return this.ruleName};P.prototype.toString=function(){return"\\p{"+this.category+"}"};var xt=class extends v{constructor(t){super();this.obj=t}_getString(t){let e=t.currentApplication().args[this.obj.index];return H(e instanceof A,"expected a Terminal expression"),e.obj}allowsSkippingPrecedingSpace(){return!0}eval(t){let{inputStream:e}=t,r=e.pos,n=this._getString(t);return e.matchString(n,!0)?(t.pushBinding(new Y(n.length),r),!0):(t.processFailure(r,this),!1)}getArity(){return 1}substituteParams(t){return new xt(this.obj.substituteParams(t))}toDisplayString(){return this.obj.toDisplayString()+" (case-insensitive)"}toFailure(t){return new j(this,this.obj.toFailure(t)+" (case-insensitive)","description")}_isNullable(t,e){return this.obj._isNullable(t,e)}};var Ne;_e(s=>{Ne=s.rules.applySyntactic.body});var zt=new x("spaces"),Re=class{constructor(t,e,r){this.matcher=t,this.startExpr=e,this.grammar=t.grammar,this.input=t.getInput(),this.inputStream=new ut(this.input),this.memoTable=t._memoTable,this.userData=void 0,this.doNotMemoize=!1,this._bindings=[],this._bindingOffsets=[],this._applicationStack=[],this._posStack=[0],this.inLexifiedContextStack=[!1],this.rightmostFailurePosition=-1,this._rightmostFailurePositionStack=[],this._recordedFailuresStack=[],r!==void 0&&(this.positionToRecordFailures=r,this.recordedFailures=Object.create(null))}posToOffset(t){return t-this._posStack[this._posStack.length-1]}enterApplication(t,e){this._posStack.push(this.inputStream.pos),this._applicationStack.push(e),this.inLexifiedContextStack.push(!1),t.enter(e),this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this.rightmostFailurePosition=-1}exitApplication(t,e){let r=this._posStack.pop();this._applicationStack.pop(),this.inLexifiedContextStack.pop(),t.exit(),this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,this._rightmostFailurePositionStack.pop()),e&&this.pushBinding(e,r)}enterLexifiedContext(){this.inLexifiedContextStack.push(!0)}exitLexifiedContext(){this.inLexifiedContextStack.pop()}currentApplication(){return this._applicationStack[this._applicationStack.length-1]}inSyntacticContext(){let t=this.currentApplication();return t?t.isSyntactic()&&!this.inLexifiedContext():this.startExpr.factors[0].isSyntactic()}inLexifiedContext(){return this.inLexifiedContextStack[this.inLexifiedContextStack.length-1]}skipSpaces(){return this.pushFailuresInfo(),this.eval(zt),this.popBinding(),this.popFailuresInfo(),this.inputStream.pos}skipSpacesIfInSyntacticContext(){return this.inSyntacticContext()?this.skipSpaces():this.inputStream.pos}maybeSkipSpacesBefore(t){return t.allowsSkippingPrecedingSpace()&&t!==zt?this.skipSpacesIfInSyntacticContext():this.inputStream.pos}pushBinding(t,e){this._bindings.push(t),this._bindingOffsets.push(this.posToOffset(e))}popBinding(){this._bindings.pop(),this._bindingOffsets.pop()}numBindings(){return this._bindings.length}truncateBindings(t){for(;this._bindings.length>t;)this.popBinding()}getCurrentPosInfo(){return this.getPosInfo(this.inputStream.pos)}getPosInfo(t){let e=this.memoTable[t];return e||(e=this.memoTable[t]=new Ae),e}processFailure(t,e){if(this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,t),this.recordedFailures&&t===this.positionToRecordFailures){let r=this.currentApplication();r&&(e=e.substituteParams(r.args)),this.recordFailure(e.toFailure(this.grammar),!1)}}recordFailure(t,e){let r=t.toKey();this.recordedFailures[r]?this.recordedFailures[r].isFluffy()&&!t.isFluffy()&&this.recordedFailures[r].clearFluffy():this.recordedFailures[r]=e?t.clone():t}recordFailures(t,e){Object.keys(t).forEach(r=>{this.recordFailure(t[r],e)})}cloneRecordedFailures(){if(!this.recordedFailures)return;let t=Object.create(null);return Object.keys(this.recordedFailures).forEach(e=>{t[e]=this.recordedFailures[e].clone()}),t}getRightmostFailurePosition(){return this.rightmostFailurePosition}_getRightmostFailureOffset(){return this.rightmostFailurePosition>=0?this.posToOffset(this.rightmostFailurePosition):-1}getMemoizedTraceEntry(t,e){let r=this.memoTable[t];if(r&&e instanceof x){let n=r.memo[e.toMemoKey()];if(n&&n.traceEntry){let i=n.traceEntry.cloneWithExpr(e);return i.isMemoized=!0,i}}return null}getTraceEntry(t,e,r,n){if(e instanceof x){let i=this.currentApplication(),o=i?i.args:[];e=e.substituteParams(o)}return this.getMemoizedTraceEntry(t,e)||new V(this.input,t,this.inputStream.pos,e,r,n,this.trace)}isTracing(){return!!this.trace}hasNecessaryInfo(t){return this.trace&&!t.traceEntry?!1:this.recordedFailures&&this.inputStream.pos+t.rightmostFailureOffset===this.positionToRecordFailures?!!t.failuresAtRightmostPosition:!0}useMemoizedResult(t,e){this.trace&&this.trace.push(e.traceEntry);let r=this.inputStream.pos+e.rightmostFailureOffset;return this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,r),this.recordedFailures&&this.positionToRecordFailures===r&&e.failuresAtRightmostPosition&&this.recordFailures(e.failuresAtRightmostPosition,!0),this.inputStream.examinedLength=Math.max(this.inputStream.examinedLength,e.examinedLength+t),e.value?(this.inputStream.pos+=e.matchLength,this.pushBinding(e.value,t),!0):!1}eval(t){let{inputStream:e}=this,r=this._bindings.length,n=this.userData,i;this.recordedFailures&&(i=this.recordedFailures,this.recordedFailures=Object.create(null));let o=e.pos,l=this.maybeSkipSpacesBefore(t),u;this.trace&&(u=this.trace,this.trace=[]);let d=t.eval(this);if(this.trace){let c=this._bindings.slice(r),h=this.getTraceEntry(l,t,d,c);h.isImplicitSpaces=t===zt,h.isRootNode=t===this.startExpr,u.push(h),this.trace=u}return d?this.recordedFailures&&e.pos===this.positionToRecordFailures&&Object.keys(this.recordedFailures).forEach(c=>{this.recordedFailures[c].makeFluffy()}):(e.pos=o,this.truncateBindings(r),this.userData=n),this.recordedFailures&&this.recordFailures(i,!1),t===Ne&&this.skipSpaces(),d}getMatchResult(){this.grammar._setUpMatchState(this),this.eval(this.startExpr);let t;this.recordedFailures&&(t=Object.keys(this.recordedFailures).map(r=>this.recordedFailures[r]));let e=this._bindings[0];return e&&(e.grammar=this.grammar),new Gt(this.matcher,this.input,this.startExpr,e,this._bindingOffsets[0],this.rightmostFailurePosition,t)}getTrace(){this.trace=[];let t=this.getMatchResult(),e=this.trace[this.trace.length-1];return e.result=t,e}pushFailuresInfo(){this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this._recordedFailuresStack.push(this.recordedFailures)}popFailuresInfo(){this.rightmostFailurePosition=this._rightmostFailurePositionStack.pop(),this.recordedFailures=this._recordedFailuresStack.pop()}},Ee=class{constructor(t){this.grammar=t,this._memoTable=[],this._input="",this._isMemoTableStale=!1}_resetMemoTable(){this._memoTable=[],this._isMemoTableStale=!1}getInput(){return this._input}setInput(t){return this._input!==t&&this.replaceInputRange(0,this._input.length,t),this}replaceInputRange(t,e,r){let n=this._input,i=this._memoTable;if(t<0||t>n.length||e<0||e>n.length||t>e)throw new Error("Invalid indices: "+t+" and "+e);this._input=n.slice(0,t)+r+n.slice(e),this._input!==n&&i.length>0&&(this._isMemoTableStale=!0);let o=i.slice(e);i.length=t;for(let l=0;l<r.length;l++)i.push(void 0);for(let l of o)i.push(l);for(let l=0;l<t;l++){let u=i[l];u&&u.clearObsoleteEntries(l,t)}return this}match(t,e={incremental:!0}){return this._match(this._getStartExpr(t),{incremental:e.incremental,tracing:!1})}trace(t,e={incremental:!0}){return this._match(this._getStartExpr(t),{incremental:e.incremental,tracing:!0})}_match(t,e={}){let r={tracing:!1,incremental:!0,positionToRecordFailures:void 0,...e};if(!r.incremental)this._resetMemoTable();else if(this._isMemoTableStale&&!this.grammar.supportsIncrementalParsing)throw as(this.grammar);let n=new Re(this,t,r.positionToRecordFailures);return r.tracing?n.getTrace():n.getMatchResult()}_getStartExpr(t){let e=t||this.grammar.defaultStartRule;if(!e)throw new Error("Missing start rule argument -- the grammar has no default start rule.");let r=this.grammar.parseApplication(e);return new w([r,E])}},ht=[],Ut=(s,t)=>Object.prototype.hasOwnProperty.call(s,t),Wt=class{constructor(t,e,r){this._node=t,this.source=e,this._baseInterval=r,t.isNonterminal()&&H(e===r),this._childWrappers=[]}_forgetMemoizedResultFor(t){delete this._node[this._semantics.attributeKeys[t]],this.children.forEach(e=>{e._forgetMemoizedResultFor(t)})}child(t){if(!(0<=t&&t<this._node.numChildren()))return;let e=this._childWrappers[t];if(!e){let r=this._node.childAt(t),n=this._node.childOffsets[t],i=this._baseInterval.subInterval(n,r.matchLength),o=r.isNonterminal()?i:this._baseInterval;e=this._childWrappers[t]=this._semantics.wrap(r,i,o)}return e}_children(){for(let t=0;t<this._node.numChildren();t++)this.child(t);return this._childWrappers}isIteration(){return this._node.isIteration()}isTerminal(){return this._node.isTerminal()}isNonterminal(){return this._node.isNonterminal()}isSyntactic(){return this.isNonterminal()&&this._node.isSyntactic()}isLexical(){return this.isNonterminal()&&this._node.isLexical()}isOptional(){return this._node.isOptional()}iteration(t){let e=t||[],r=e.map(o=>o._node),n=new qt(r,[],-1,!1),i=this._semantics.wrap(n,null,null);return i._childWrappers=e,i}get children(){return this._children()}get ctorName(){return this._node.ctorName}get numChildren(){return this._node.numChildren()}get sourceString(){return this.source.contents}},G=class{constructor(t,e){let r=this;if(this.grammar=t,this.checkedActionDicts=!1,this.Wrapper=class extends(e?e.Wrapper:Wt){constructor(n,i,o){super(n,i,o);r.checkActionDictsIfHaventAlready(),this._semantics=r}toString(){return"[semantics wrapper for "+r.grammar.name+"]"}},this.super=e,e){if(!(t.equals(this.super.grammar)||t._inheritsFrom(this.super.grammar)))throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+t.name+"' (not a sub-grammar)");this.operations=Object.create(this.super.operations),this.attributes=Object.create(this.super.attributes),this.attributeKeys=Object.create(null);for(let n in this.attributes)Object.defineProperty(this.attributeKeys,n,{value:we(n)})}else this.operations=Object.create(null),this.attributes=Object.create(null),this.attributeKeys=Object.create(null)}toString(){return"[semantics for "+this.grammar.name+"]"}checkActionDictsIfHaventAlready(){this.checkedActionDicts||(this.checkActionDicts(),this.checkedActionDicts=!0)}checkActionDicts(){let t;for(t in this.operations)this.operations[t].checkActionDict(this.grammar);for(t in this.attributes)this.attributes[t].checkActionDict(this.grammar)}toRecipe(t){function e(n){return n.super!==G.BuiltInSemantics._getSemantics()}let r=`(function(g) {
`;if(e(this)){r+="  var semantics = "+this.super.toRecipe(!0)+"(g";let n=this.super.grammar,i=this.grammar;for(;i!==n;)r+=".superGrammar",i=i.superGrammar;r+=`);
`,r+="  return g.extendSemantics(semantics)"}else r+="  return g.createSemantics()";return["Operation","Attribute"].forEach(n=>{let i=this[n.toLowerCase()+"s"];Object.keys(i).forEach(o=>{let{actionDict:l,formals:u,builtInDefault:d}=i[o],c=o;u.length>0&&(c+="("+u.join(", ")+")");let h;e(this)&&this.super[n.toLowerCase()+"s"][o]?h="extend"+n:h="add"+n,r+=`
    .`+h+"("+JSON.stringify(c)+", {";let f=[];Object.keys(l).forEach(m=>{if(l[m]!==d){let y=l[m].toString().trim();y=y.replace(/^.*\(/,"function("),f.push(`
      `+JSON.stringify(m)+": "+y)}}),r+=f.join(",")+`
    })`})}),r+=`;
  })`,t||(r=`(function() {
  var grammar = this.fromRecipe(`+this.grammar.toRecipe()+`);
  var semantics = `+r+`(grammar);
  return semantics;
});
`),r}addOperationOrAttribute(t,e,r){let n=t+"s",i=Fe(e,t),{name:o}=i,{formals:l}=i;this.assertNewName(o,t);let u=Ds(t,o,h),d={_default:u};Object.keys(r).forEach(f=>{d[f]=r[f]});let c=t==="operation"?new nt(o,l,d,u):new It(o,d,u);c.checkActionDict(this.grammar),this[n][o]=c;function h(...f){let m=this._semantics[n][o];if(arguments.length!==m.formals.length)throw new Error("Invalid number of arguments passed to "+o+" "+t+" (expected "+m.formals.length+", got "+arguments.length+")");let y=Object.create(null);for(let[J,it]of Object.entries(f)){let Je=m.formals[J];y[Je]=it}let I=this.args;this.args=y;let S=m.execute(this._semantics,this);return this.args=I,S}t==="operation"?(this.Wrapper.prototype[o]=h,this.Wrapper.prototype[o].toString=function(){return"["+o+" operation]"}):(Object.defineProperty(this.Wrapper.prototype,o,{get:h,configurable:!0}),Object.defineProperty(this.attributeKeys,o,{value:we(o)}))}extendOperationOrAttribute(t,e,r){let n=t+"s";if(Fe(e,"attribute"),!(this.super&&e in this.super[n]))throw new Error("Cannot extend "+t+" '"+e+"': did not inherit an "+t+" with that name");if(Ut(this[n],e))throw new Error("Cannot extend "+t+" '"+e+"' again");let i=this[n][e].formals,o=this[n][e].actionDict,l=Object.create(o);Object.keys(r).forEach(u=>{l[u]=r[u]}),this[n][e]=t==="operation"?new nt(e,i,l):new It(e,l),this[n][e].checkActionDict(this.grammar)}assertNewName(t,e){if(Ut(Wt.prototype,t))throw new Error("Cannot add "+e+" '"+t+"': that's a reserved name");if(t in this.operations)throw new Error("Cannot add "+e+" '"+t+"': an operation with that name already exists");if(t in this.attributes)throw new Error("Cannot add "+e+" '"+t+"': an attribute with that name already exists")}wrap(t,e,r){let n=r||e;return t instanceof this.Wrapper?t:new this.Wrapper(t,e,n)}};function Fe(s,t){if(!G.prototypeGrammar)return H(s.indexOf("(")===-1),{name:s,formals:[]};let e=G.prototypeGrammar.match(s,t==="operation"?"OperationSignature":"AttributeSignature");if(e.failed())throw new Error(e.message);return G.prototypeGrammarSemantics(e).parse()}function Ds(s,t,e){return function(...r){let i=(this._semantics.operations[t]||this._semantics.attributes[t]).formals.map(o=>this.args[o]);if(!this.isIteration()&&r.length===1)return e.apply(r[0],i);throw xs(this.ctorName,t,s,ht)}}G.createSemantics=function(s,t){let e=new G(s,t!==void 0?t:G.BuiltInSemantics._getSemantics()),r=function(i){if(!(i instanceof Gt))throw new TypeError("Semantics expected a MatchResult, but got "+Dt(i));if(i.failed())throw new TypeError("cannot apply Semantics to "+i.toString());let o=i._cst;if(o.grammar!==s)throw new Error("Cannot use a MatchResult from grammar '"+o.grammar.name+"' with a semantics for '"+s.name+"'");let l=new ut(i.input);return e.wrap(o,l.interval(i._cstOffset,i.input.length))};return r.addOperation=function(n,i){return e.addOperationOrAttribute("operation",n,i),r},r.extendOperation=function(n,i){return e.extendOperationOrAttribute("operation",n,i),r},r.addAttribute=function(n,i){return e.addOperationOrAttribute("attribute",n,i),r},r.extendAttribute=function(n,i){return e.extendOperationOrAttribute("attribute",n,i),r},r._getActionDict=function(n){let i=e.operations[n]||e.attributes[n];if(!i)throw new Error('"'+n+'" is not a valid operation or attribute name in this semantics for "'+s.name+'"');return i.actionDict},r._remove=function(n){let i;return n in e.operations?(i=e.operations[n],delete e.operations[n]):n in e.attributes&&(i=e.attributes[n],delete e.attributes[n]),delete e.Wrapper.prototype[n],i},r.getOperationNames=function(){return Object.keys(e.operations)},r.getAttributeNames=function(){return Object.keys(e.attributes)},r.getGrammar=function(){return e.grammar},r.toRecipe=function(n){return e.toRecipe(n)},r.toString=e.toString.bind(e),r._getSemantics=function(){return e},r};var nt=class{constructor(t,e,r,n){this.name=t,this.formals=e,this.actionDict=r,this.builtInDefault=n}checkActionDict(t){t._checkTopDownActionDict(this.typeName,this.name,this.actionDict)}execute(t,e){try{let{ctorName:r}=e._node,n=this.actionDict[r];return n?(ht.push([this,r]),n.apply(e,e._children())):e.isNonterminal()&&(n=this.actionDict._nonterminal,n)?(ht.push([this,"_nonterminal",r]),n.apply(e,e._children())):(ht.push([this,"default action",r]),this.actionDict._default.apply(e,e._children()))}finally{ht.pop()}}};nt.prototype.typeName="operation";var It=class extends nt{constructor(t,e,r){super(t,[],e,r)}execute(t,e){let r=e._node,n=t.attributeKeys[this.name];return Ut(r,n)||(r[n]=nt.prototype.execute.call(this,t,e)),r[n]}};It.prototype.typeName="attribute";var Te=["_iter","_terminal","_nonterminal","_default"];function Ce(s){return Object.keys(s.rules).sort().map(t=>s.rules[t])}var Ms=s=>s.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"),De,Me,D=class{constructor(t,e,r,n){if(this.name=t,this.superGrammar=e,this.rules=r,n){if(!(n in r))throw new Error("Invalid start rule: '"+n+"' is not a rule in grammar '"+t+"'");this.defaultStartRule=n}this._matchStateInitializer=void 0,this.supportsIncrementalParsing=!0}matcher(){return new Ee(this)}isBuiltIn(){return this===D.ProtoBuiltInRules||this===D.BuiltInRules}equals(t){if(this===t)return!0;if(t==null||this.name!==t.name||this.defaultStartRule!==t.defaultStartRule||!(this.superGrammar===t.superGrammar||this.superGrammar.equals(t.superGrammar)))return!1;let e=Ce(this),r=Ce(t);return e.length===r.length&&e.every((n,i)=>n.description===r[i].description&&n.formals.join(",")===r[i].formals.join(",")&&n.body.toString()===r[i].body.toString())}match(t,e){let r=this.matcher();return r.replaceInputRange(0,0,t),r.match(e)}trace(t,e){let r=this.matcher();return r.replaceInputRange(0,0,t),r.trace(e)}createSemantics(){return G.createSemantics(this)}extendSemantics(t){return G.createSemantics(this,t._getSemantics())}_checkTopDownActionDict(t,e,r){let n=[];for(let i in r){let o=r[i];if(!Te.includes(i)&&!(i in this.rules)){n.push(`'${i}' is not a valid semantic action for '${this.name}'`);continue}if(typeof o!="function"){n.push(`'${i}' must be a function in an action dictionary for '${this.name}'`);continue}let u=o.length,d=this._topDownActionArity(i);if(u!==d){let c;i==="_iter"||i==="_nonterminal"?c=`it should use a rest parameter, e.g. \`${i}(...children) {}\`. NOTE: this is new in Ohm v16 — see https://ohmjs.org/d/ati for details.`:c=`expected ${d}, got ${u}`,n.push(`Semantic action '${i}' has the wrong arity: ${c}`)}}if(n.length>0){let i=n.map(l=>"- "+l),o=new Error([`Found errors in the action dictionary of the '${e}' ${t}:`,...i].join(`
`));throw o.problems=n,o}}_topDownActionArity(t){return Te.includes(t)?0:this.rules[t].body.getArity()}_inheritsFrom(t){let e=this.superGrammar;for(;e;){if(e.equals(t,!0))return!0;e=e.superGrammar}return!1}toRecipe(t=void 0){let e={};this.source&&(e.source=this.source.contents);let r=null;this.defaultStartRule&&(r=this.defaultStartRule);let n={};Object.keys(this.rules).forEach(l=>{let u=this.rules[l],{body:d}=u,c=!this.superGrammar||!this.superGrammar.rules[l],h;c?h="define":h=d instanceof at?"extend":"override";let f={};if(u.source&&this.source){let I=u.source.relativeTo(this.source);f.sourceInterval=[I.startIdx,I.endIdx]}let m=c?u.description:null,y=d.outputRecipe(u.formals,this.source);n[l]=[h,f,m,u.formals,y]});let i="null";t?i=t:this.superGrammar&&!this.superGrammar.isBuiltIn()&&(i=this.superGrammar.toRecipe());let o=[...["grammar",e,this.name].map(JSON.stringify),i,...[r,n].map(JSON.stringify)];return Ms(`[${o.join(",")}]`)}toOperationActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}toAttributeActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}_toOperationOrAttributeActionDictionaryTemplate(){let t=new et;t.append("{");let e=!0;for(let r in this.rules){let{body:n}=this.rules[r];e?e=!1:t.append(","),t.append(`
`),t.append("  "),this.addSemanticActionTemplate(r,n,t)}return t.append(`
}`),t.contents()}addSemanticActionTemplate(t,e,r){r.append(t),r.append(": function(");let n=this._topDownActionArity(t);r.append(gt("_",n).join(", ")),r.append(`) {
`),r.append("  }")}parseApplication(t){let e;if(t.indexOf("<")===-1)e=new x(t);else{let n=De.match(t,"Base_application");e=Me(n,{})}if(!(e.ruleName in this.rules))throw me(e.ruleName,this.name);let{formals:r}=this.rules[e.ruleName];if(r.length!==e.args.length){let{source:n}=this.rules[e.ruleName];throw ye(e.ruleName,r.length,e.args.length,n)}return e}_setUpMatchState(t){this._matchStateInitializer&&this._matchStateInitializer(t)}};D.ProtoBuiltInRules=new D("ProtoBuiltInRules",void 0,{any:{body:R,formals:[],description:"any character",primitive:!0},end:{body:E,formals:[],description:"end of input",primitive:!0},caseInsensitive:{body:new xt(new O(0)),formals:["str"],primitive:!0},lower:{body:new P("Ll"),formals:[],description:"a lowercase letter",primitive:!0},upper:{body:new P("Lu"),formals:[],description:"an uppercase letter",primitive:!0},unicodeLtmo:{body:new P("Ltmo"),formals:[],description:"a Unicode character in Lt, Lm, or Lo",primitive:!0},spaces:{body:new X(new x("space")),formals:[]},space:{body:new L("\0"," "),formals:[],description:"a space"}});D.initApplicationParser=function(s,t){De=s,Me=t};var Vt=class{constructor(t){this.name=t}sourceInterval(t,e){return this.source.subInterval(t,e-t)}ensureSuperGrammar(){return this.superGrammar||this.withSuperGrammar(this.name==="BuiltInRules"?D.ProtoBuiltInRules:D.BuiltInRules),this.superGrammar}ensureSuperGrammarRuleForOverriding(t,e){let r=this.ensureSuperGrammar().rules[t];if(!r)throw ls(t,this.superGrammar.name,e);return r}installOverriddenOrExtendedRule(t,e,r,n){let i=Tt(e);if(i.length>0)throw ve(t,i,n);let o=this.ensureSuperGrammar().rules[t],l=o.formals,u=l?l.length:0;if(e.length!==u)throw ye(t,u,e.length,n);return this.install(t,e,r,o.description,n)}install(t,e,r,n,i,o=!1){return this.rules[t]={body:r.introduceParams(e),formals:e,description:n,source:i,primitive:o},this}withSuperGrammar(t){if(this.superGrammar)throw new Error("the super grammar of a GrammarDecl cannot be set more than once");return this.superGrammar=t,this.rules=Object.create(t.rules),t.isBuiltIn()||(this.defaultStartRule=t.defaultStartRule),this}withDefaultStartRule(t){return this.defaultStartRule=t,this}withSource(t){return this.source=new ut(t).interval(0,t.length),this}build(){let t=new D(this.name,this.ensureSuperGrammar(),this.rules,this.defaultStartRule);t._matchStateInitializer=t.superGrammar._matchStateInitializer,t.supportsIncrementalParsing=t.superGrammar.supportsIncrementalParsing;let e=[],r=!1;return Object.keys(t.rules).forEach(n=>{let{body:i}=t.rules[n];try{i.assertChoicesHaveUniformArity(n)}catch(o){e.push(o)}try{i.assertAllApplicationsAreValid(n,t)}catch(o){e.push(o),r=!0}}),r||Object.keys(t.rules).forEach(n=>{let{body:i}=t.rules[n];try{i.assertIteratedExprsAreNotNullable(t,[])}catch(o){e.push(o)}}),e.length>0&&Is(e),this.source&&(t.source=this.source),t}define(t,e,r,n,i,o){if(this.ensureSuperGrammar(),this.superGrammar.rules[t])throw ge(t,this.name,this.superGrammar.name,i);if(this.rules[t])throw ge(t,this.name,this.name,i);let l=Tt(e);if(l.length>0)throw ve(t,l,i);return this.install(t,e,r,n,i,o)}override(t,e,r,n,i){return this.ensureSuperGrammarRuleForOverriding(t,i),this.installOverriddenOrExtendedRule(t,e,r,i),this}extend(t,e,r,n,i){if(!this.ensureSuperGrammar().rules[t])throw us(t,this.superGrammar.name,i);let l=new at(this.superGrammar,t,r);return l.source=r.source,this.installOverriddenOrExtendedRule(t,e,l,i),this}},pt=class{constructor(){this.currentDecl=null,this.currentRuleName=null}newGrammar(t){return new Vt(t)}grammar(t,e,r,n,i){let o=new Vt(e);return r&&o.withSuperGrammar(r instanceof D?r:this.fromRecipe(r)),n&&o.withDefaultStartRule(n),t&&t.source&&o.withSource(t.source),this.currentDecl=o,Object.keys(i).forEach(l=>{this.currentRuleName=l;let u=i[l],d=u[0],c=u[1],h=u[2],f=u[3],m=this.fromRecipe(u[4]),y;o.source&&c&&c.sourceInterval&&(y=o.source.subInterval(c.sourceInterval[0],c.sourceInterval[1]-c.sourceInterval[0])),o[d](l,f,m,h,y)}),this.currentRuleName=this.currentDecl=null,o.build()}terminal(t){return new A(t)}range(t,e){return new L(t,e)}param(t){return new O(t)}alt(...t){let e=[];for(let r of t)r instanceof v||(r=this.fromRecipe(r)),r instanceof _?e=e.concat(r.terms):e.push(r);return e.length===1?e[0]:new _(e)}seq(...t){let e=[];for(let r of t)r instanceof v||(r=this.fromRecipe(r)),r instanceof w?e=e.concat(r.factors):e.push(r);return e.length===1?e[0]:new w(e)}star(t){return t instanceof v||(t=this.fromRecipe(t)),new X(t)}plus(t){return t instanceof v||(t=this.fromRecipe(t)),new st(t)}opt(t){return t instanceof v||(t=this.fromRecipe(t)),new U(t)}not(t){return t instanceof v||(t=this.fromRecipe(t)),new T(t)}lookahead(t){return t instanceof v||(t=this.fromRecipe(t)),new C(t)}lex(t){return t instanceof v||(t=this.fromRecipe(t)),new B(t)}app(t,e){return e&&e.length>0&&(e=e.map(function(r){return r instanceof v?r:this.fromRecipe(r)},this)),new x(t,e)}splice(t,e){return new lt(this.currentDecl.superGrammar,this.currentRuleName,t.map(r=>this.fromRecipe(r)),e.map(r=>this.fromRecipe(r)))}fromRecipe(t){let e=t[0]==="grammar"?t.slice(1):t.slice(2),r=this[t[0]](...e),n=t[1];return n&&n.sourceInterval&&this.currentDecl&&r.withSource(this.currentDecl.sourceInterval(...n.sourceInterval)),r}};function Ht(s){return typeof s=="function"?s.call(new pt):(typeof s=="string"&&(s=JSON.parse(s)),new pt().fromRecipe(s))}var Xt=Ht(["grammar",{source:`BuiltInRules {

  alnum  (an alpha-numeric character)
    = letter
    | digit

  letter  (a letter)
    = lower
    | upper
    | unicodeLtmo

  digit  (a digit)
    = "0".."9"

  hexDigit  (a hexadecimal digit)
    = digit
    | "a".."f"
    | "A".."F"

  ListOf<elem, sep>
    = NonemptyListOf<elem, sep>
    | EmptyListOf<elem, sep>

  NonemptyListOf<elem, sep>
    = elem (sep elem)*

  EmptyListOf<elem, sep>
    = /* nothing */

  listOf<elem, sep>
    = nonemptyListOf<elem, sep>
    | emptyListOf<elem, sep>

  nonemptyListOf<elem, sep>
    = elem (sep elem)*

  emptyListOf<elem, sep>
    = /* nothing */

  // Allows a syntactic rule application within a lexical context.
  applySyntactic<app> = app
}`},"BuiltInRules",null,null,{alnum:["define",{sourceInterval:[18,78]},"an alpha-numeric character",[],["alt",{sourceInterval:[60,78]},["app",{sourceInterval:[60,66]},"letter",[]],["app",{sourceInterval:[73,78]},"digit",[]]]],letter:["define",{sourceInterval:[82,142]},"a letter",[],["alt",{sourceInterval:[107,142]},["app",{sourceInterval:[107,112]},"lower",[]],["app",{sourceInterval:[119,124]},"upper",[]],["app",{sourceInterval:[131,142]},"unicodeLtmo",[]]]],digit:["define",{sourceInterval:[146,177]},"a digit",[],["range",{sourceInterval:[169,177]},"0","9"]],hexDigit:["define",{sourceInterval:[181,254]},"a hexadecimal digit",[],["alt",{sourceInterval:[219,254]},["app",{sourceInterval:[219,224]},"digit",[]],["range",{sourceInterval:[231,239]},"a","f"],["range",{sourceInterval:[246,254]},"A","F"]]],ListOf:["define",{sourceInterval:[258,336]},null,["elem","sep"],["alt",{sourceInterval:[282,336]},["app",{sourceInterval:[282,307]},"NonemptyListOf",[["param",{sourceInterval:[297,301]},0],["param",{sourceInterval:[303,306]},1]]],["app",{sourceInterval:[314,336]},"EmptyListOf",[["param",{sourceInterval:[326,330]},0],["param",{sourceInterval:[332,335]},1]]]]],NonemptyListOf:["define",{sourceInterval:[340,388]},null,["elem","sep"],["seq",{sourceInterval:[372,388]},["param",{sourceInterval:[372,376]},0],["star",{sourceInterval:[377,388]},["seq",{sourceInterval:[378,386]},["param",{sourceInterval:[378,381]},1],["param",{sourceInterval:[382,386]},0]]]]],EmptyListOf:["define",{sourceInterval:[392,434]},null,["elem","sep"],["seq",{sourceInterval:[438,438]}]],listOf:["define",{sourceInterval:[438,516]},null,["elem","sep"],["alt",{sourceInterval:[462,516]},["app",{sourceInterval:[462,487]},"nonemptyListOf",[["param",{sourceInterval:[477,481]},0],["param",{sourceInterval:[483,486]},1]]],["app",{sourceInterval:[494,516]},"emptyListOf",[["param",{sourceInterval:[506,510]},0],["param",{sourceInterval:[512,515]},1]]]]],nonemptyListOf:["define",{sourceInterval:[520,568]},null,["elem","sep"],["seq",{sourceInterval:[552,568]},["param",{sourceInterval:[552,556]},0],["star",{sourceInterval:[557,568]},["seq",{sourceInterval:[558,566]},["param",{sourceInterval:[558,561]},1],["param",{sourceInterval:[562,566]},0]]]]],emptyListOf:["define",{sourceInterval:[572,682]},null,["elem","sep"],["seq",{sourceInterval:[685,685]}]],applySyntactic:["define",{sourceInterval:[685,710]},null,["app"],["param",{sourceInterval:[707,710]},0]]}]);D.BuiltInRules=Xt;_s(D.BuiltInRules);var Yt=Ht(["grammar",{source:`Ohm {

  Grammars
    = Grammar*

  Grammar
    = ident SuperGrammar? "{" Rule* "}"

  SuperGrammar
    = "<:" ident

  Rule
    = ident Formals? ruleDescr? "="  RuleBody  -- define
    | ident Formals?            ":=" OverrideRuleBody  -- override
    | ident Formals?            "+=" RuleBody  -- extend

  RuleBody
    = "|"? NonemptyListOf<TopLevelTerm, "|">

  TopLevelTerm
    = Seq caseName  -- inline
    | Seq

  OverrideRuleBody
    = "|"? NonemptyListOf<OverrideTopLevelTerm, "|">

  OverrideTopLevelTerm
    = "..."  -- superSplice
    | TopLevelTerm

  Formals
    = "<" ListOf<ident, ","> ">"

  Params
    = "<" ListOf<Seq, ","> ">"

  Alt
    = NonemptyListOf<Seq, "|">

  Seq
    = Iter*

  Iter
    = Pred "*"  -- star
    | Pred "+"  -- plus
    | Pred "?"  -- opt
    | Pred

  Pred
    = "~" Lex  -- not
    | "&" Lex  -- lookahead
    | Lex

  Lex
    = "#" Base  -- lex
    | Base

  Base
    = ident Params? ~(ruleDescr? "=" | ":=" | "+=")  -- application
    | oneCharTerminal ".." oneCharTerminal           -- range
    | terminal                                       -- terminal
    | "(" Alt ")"                                    -- paren

  ruleDescr  (a rule description)
    = "(" ruleDescrText ")"

  ruleDescrText
    = (~")" any)*

  caseName
    = "--" (~"\\n" space)* name (~"\\n" space)* ("\\n" | &"}")

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

  ident  (an identifier)
    = name

  terminal
    = "\\"" terminalChar* "\\""

  oneCharTerminal
    = "\\"" terminalChar "\\""

  terminalChar
    = escapeChar
      | ~"\\\\" ~"\\"" ~"\\n" "\\u{0}".."\\u{10FFFF}"

  escapeChar  (an escape sequence)
    = "\\\\\\\\"                                     -- backslash
    | "\\\\\\""                                     -- doubleQuote
    | "\\\\\\'"                                     -- singleQuote
    | "\\\\b"                                      -- backspace
    | "\\\\n"                                      -- lineFeed
    | "\\\\r"                                      -- carriageReturn
    | "\\\\t"                                      -- tab
    | "\\\\u{" hexDigit hexDigit? hexDigit?
             hexDigit? hexDigit? hexDigit? "}"   -- unicodeCodePoint
    | "\\\\u" hexDigit hexDigit hexDigit hexDigit  -- unicodeEscape
    | "\\\\x" hexDigit hexDigit                    -- hexEscape

  space
   += comment

  comment
    = "//" (~"\\n" any)* &("\\n" | end)  -- singleLine
    | "/*" (~"*/" any)* "*/"  -- multiLine

  tokens = token*

  token = caseName | comment | ident | operator | punctuation | terminal | any

  operator = "<:" | "=" | ":=" | "+=" | "*" | "+" | "?" | "~" | "&"

  punctuation = "<" | ">" | "," | "--"
}`},"Ohm",null,"Grammars",{Grammars:["define",{sourceInterval:[9,32]},null,[],["star",{sourceInterval:[24,32]},["app",{sourceInterval:[24,31]},"Grammar",[]]]],Grammar:["define",{sourceInterval:[36,83]},null,[],["seq",{sourceInterval:[50,83]},["app",{sourceInterval:[50,55]},"ident",[]],["opt",{sourceInterval:[56,69]},["app",{sourceInterval:[56,68]},"SuperGrammar",[]]],["terminal",{sourceInterval:[70,73]},"{"],["star",{sourceInterval:[74,79]},["app",{sourceInterval:[74,78]},"Rule",[]]],["terminal",{sourceInterval:[80,83]},"}"]]],SuperGrammar:["define",{sourceInterval:[87,116]},null,[],["seq",{sourceInterval:[106,116]},["terminal",{sourceInterval:[106,110]},"<:"],["app",{sourceInterval:[111,116]},"ident",[]]]],Rule_define:["define",{sourceInterval:[131,181]},null,[],["seq",{sourceInterval:[131,170]},["app",{sourceInterval:[131,136]},"ident",[]],["opt",{sourceInterval:[137,145]},["app",{sourceInterval:[137,144]},"Formals",[]]],["opt",{sourceInterval:[146,156]},["app",{sourceInterval:[146,155]},"ruleDescr",[]]],["terminal",{sourceInterval:[157,160]},"="],["app",{sourceInterval:[162,170]},"RuleBody",[]]]],Rule_override:["define",{sourceInterval:[188,248]},null,[],["seq",{sourceInterval:[188,235]},["app",{sourceInterval:[188,193]},"ident",[]],["opt",{sourceInterval:[194,202]},["app",{sourceInterval:[194,201]},"Formals",[]]],["terminal",{sourceInterval:[214,218]},":="],["app",{sourceInterval:[219,235]},"OverrideRuleBody",[]]]],Rule_extend:["define",{sourceInterval:[255,305]},null,[],["seq",{sourceInterval:[255,294]},["app",{sourceInterval:[255,260]},"ident",[]],["opt",{sourceInterval:[261,269]},["app",{sourceInterval:[261,268]},"Formals",[]]],["terminal",{sourceInterval:[281,285]},"+="],["app",{sourceInterval:[286,294]},"RuleBody",[]]]],Rule:["define",{sourceInterval:[120,305]},null,[],["alt",{sourceInterval:[131,305]},["app",{sourceInterval:[131,170]},"Rule_define",[]],["app",{sourceInterval:[188,235]},"Rule_override",[]],["app",{sourceInterval:[255,294]},"Rule_extend",[]]]],RuleBody:["define",{sourceInterval:[309,362]},null,[],["seq",{sourceInterval:[324,362]},["opt",{sourceInterval:[324,328]},["terminal",{sourceInterval:[324,327]},"|"]],["app",{sourceInterval:[329,362]},"NonemptyListOf",[["app",{sourceInterval:[344,356]},"TopLevelTerm",[]],["terminal",{sourceInterval:[358,361]},"|"]]]]],TopLevelTerm_inline:["define",{sourceInterval:[385,408]},null,[],["seq",{sourceInterval:[385,397]},["app",{sourceInterval:[385,388]},"Seq",[]],["app",{sourceInterval:[389,397]},"caseName",[]]]],TopLevelTerm:["define",{sourceInterval:[366,418]},null,[],["alt",{sourceInterval:[385,418]},["app",{sourceInterval:[385,397]},"TopLevelTerm_inline",[]],["app",{sourceInterval:[415,418]},"Seq",[]]]],OverrideRuleBody:["define",{sourceInterval:[422,491]},null,[],["seq",{sourceInterval:[445,491]},["opt",{sourceInterval:[445,449]},["terminal",{sourceInterval:[445,448]},"|"]],["app",{sourceInterval:[450,491]},"NonemptyListOf",[["app",{sourceInterval:[465,485]},"OverrideTopLevelTerm",[]],["terminal",{sourceInterval:[487,490]},"|"]]]]],OverrideTopLevelTerm_superSplice:["define",{sourceInterval:[522,543]},null,[],["terminal",{sourceInterval:[522,527]},"..."]],OverrideTopLevelTerm:["define",{sourceInterval:[495,562]},null,[],["alt",{sourceInterval:[522,562]},["app",{sourceInterval:[522,527]},"OverrideTopLevelTerm_superSplice",[]],["app",{sourceInterval:[550,562]},"TopLevelTerm",[]]]],Formals:["define",{sourceInterval:[566,606]},null,[],["seq",{sourceInterval:[580,606]},["terminal",{sourceInterval:[580,583]},"<"],["app",{sourceInterval:[584,602]},"ListOf",[["app",{sourceInterval:[591,596]},"ident",[]],["terminal",{sourceInterval:[598,601]},","]]],["terminal",{sourceInterval:[603,606]},">"]]],Params:["define",{sourceInterval:[610,647]},null,[],["seq",{sourceInterval:[623,647]},["terminal",{sourceInterval:[623,626]},"<"],["app",{sourceInterval:[627,643]},"ListOf",[["app",{sourceInterval:[634,637]},"Seq",[]],["terminal",{sourceInterval:[639,642]},","]]],["terminal",{sourceInterval:[644,647]},">"]]],Alt:["define",{sourceInterval:[651,685]},null,[],["app",{sourceInterval:[661,685]},"NonemptyListOf",[["app",{sourceInterval:[676,679]},"Seq",[]],["terminal",{sourceInterval:[681,684]},"|"]]]],Seq:["define",{sourceInterval:[689,704]},null,[],["star",{sourceInterval:[699,704]},["app",{sourceInterval:[699,703]},"Iter",[]]]],Iter_star:["define",{sourceInterval:[719,736]},null,[],["seq",{sourceInterval:[719,727]},["app",{sourceInterval:[719,723]},"Pred",[]],["terminal",{sourceInterval:[724,727]},"*"]]],Iter_plus:["define",{sourceInterval:[743,760]},null,[],["seq",{sourceInterval:[743,751]},["app",{sourceInterval:[743,747]},"Pred",[]],["terminal",{sourceInterval:[748,751]},"+"]]],Iter_opt:["define",{sourceInterval:[767,783]},null,[],["seq",{sourceInterval:[767,775]},["app",{sourceInterval:[767,771]},"Pred",[]],["terminal",{sourceInterval:[772,775]},"?"]]],Iter:["define",{sourceInterval:[708,794]},null,[],["alt",{sourceInterval:[719,794]},["app",{sourceInterval:[719,727]},"Iter_star",[]],["app",{sourceInterval:[743,751]},"Iter_plus",[]],["app",{sourceInterval:[767,775]},"Iter_opt",[]],["app",{sourceInterval:[790,794]},"Pred",[]]]],Pred_not:["define",{sourceInterval:[809,824]},null,[],["seq",{sourceInterval:[809,816]},["terminal",{sourceInterval:[809,812]},"~"],["app",{sourceInterval:[813,816]},"Lex",[]]]],Pred_lookahead:["define",{sourceInterval:[831,852]},null,[],["seq",{sourceInterval:[831,838]},["terminal",{sourceInterval:[831,834]},"&"],["app",{sourceInterval:[835,838]},"Lex",[]]]],Pred:["define",{sourceInterval:[798,862]},null,[],["alt",{sourceInterval:[809,862]},["app",{sourceInterval:[809,816]},"Pred_not",[]],["app",{sourceInterval:[831,838]},"Pred_lookahead",[]],["app",{sourceInterval:[859,862]},"Lex",[]]]],Lex_lex:["define",{sourceInterval:[876,892]},null,[],["seq",{sourceInterval:[876,884]},["terminal",{sourceInterval:[876,879]},"#"],["app",{sourceInterval:[880,884]},"Base",[]]]],Lex:["define",{sourceInterval:[866,903]},null,[],["alt",{sourceInterval:[876,903]},["app",{sourceInterval:[876,884]},"Lex_lex",[]],["app",{sourceInterval:[899,903]},"Base",[]]]],Base_application:["define",{sourceInterval:[918,979]},null,[],["seq",{sourceInterval:[918,963]},["app",{sourceInterval:[918,923]},"ident",[]],["opt",{sourceInterval:[924,931]},["app",{sourceInterval:[924,930]},"Params",[]]],["not",{sourceInterval:[932,963]},["alt",{sourceInterval:[934,962]},["seq",{sourceInterval:[934,948]},["opt",{sourceInterval:[934,944]},["app",{sourceInterval:[934,943]},"ruleDescr",[]]],["terminal",{sourceInterval:[945,948]},"="]],["terminal",{sourceInterval:[951,955]},":="],["terminal",{sourceInterval:[958,962]},"+="]]]]],Base_range:["define",{sourceInterval:[986,1041]},null,[],["seq",{sourceInterval:[986,1022]},["app",{sourceInterval:[986,1001]},"oneCharTerminal",[]],["terminal",{sourceInterval:[1002,1006]},".."],["app",{sourceInterval:[1007,1022]},"oneCharTerminal",[]]]],Base_terminal:["define",{sourceInterval:[1048,1106]},null,[],["app",{sourceInterval:[1048,1056]},"terminal",[]]],Base_paren:["define",{sourceInterval:[1113,1168]},null,[],["seq",{sourceInterval:[1113,1124]},["terminal",{sourceInterval:[1113,1116]},"("],["app",{sourceInterval:[1117,1120]},"Alt",[]],["terminal",{sourceInterval:[1121,1124]},")"]]],Base:["define",{sourceInterval:[907,1168]},null,[],["alt",{sourceInterval:[918,1168]},["app",{sourceInterval:[918,963]},"Base_application",[]],["app",{sourceInterval:[986,1022]},"Base_range",[]],["app",{sourceInterval:[1048,1056]},"Base_terminal",[]],["app",{sourceInterval:[1113,1124]},"Base_paren",[]]]],ruleDescr:["define",{sourceInterval:[1172,1231]},"a rule description",[],["seq",{sourceInterval:[1210,1231]},["terminal",{sourceInterval:[1210,1213]},"("],["app",{sourceInterval:[1214,1227]},"ruleDescrText",[]],["terminal",{sourceInterval:[1228,1231]},")"]]],ruleDescrText:["define",{sourceInterval:[1235,1266]},null,[],["star",{sourceInterval:[1255,1266]},["seq",{sourceInterval:[1256,1264]},["not",{sourceInterval:[1256,1260]},["terminal",{sourceInterval:[1257,1260]},")"]],["app",{sourceInterval:[1261,1264]},"any",[]]]]],caseName:["define",{sourceInterval:[1270,1338]},null,[],["seq",{sourceInterval:[1285,1338]},["terminal",{sourceInterval:[1285,1289]},"--"],["star",{sourceInterval:[1290,1304]},["seq",{sourceInterval:[1291,1302]},["not",{sourceInterval:[1291,1296]},["terminal",{sourceInterval:[1292,1296]},`
`]],["app",{sourceInterval:[1297,1302]},"space",[]]]],["app",{sourceInterval:[1305,1309]},"name",[]],["star",{sourceInterval:[1310,1324]},["seq",{sourceInterval:[1311,1322]},["not",{sourceInterval:[1311,1316]},["terminal",{sourceInterval:[1312,1316]},`
`]],["app",{sourceInterval:[1317,1322]},"space",[]]]],["alt",{sourceInterval:[1326,1337]},["terminal",{sourceInterval:[1326,1330]},`
`],["lookahead",{sourceInterval:[1333,1337]},["terminal",{sourceInterval:[1334,1337]},"}"]]]]],name:["define",{sourceInterval:[1342,1382]},"a name",[],["seq",{sourceInterval:[1363,1382]},["app",{sourceInterval:[1363,1372]},"nameFirst",[]],["star",{sourceInterval:[1373,1382]},["app",{sourceInterval:[1373,1381]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[1386,1418]},null,[],["alt",{sourceInterval:[1402,1418]},["terminal",{sourceInterval:[1402,1405]},"_"],["app",{sourceInterval:[1412,1418]},"letter",[]]]],nameRest:["define",{sourceInterval:[1422,1452]},null,[],["alt",{sourceInterval:[1437,1452]},["terminal",{sourceInterval:[1437,1440]},"_"],["app",{sourceInterval:[1447,1452]},"alnum",[]]]],ident:["define",{sourceInterval:[1456,1489]},"an identifier",[],["app",{sourceInterval:[1485,1489]},"name",[]]],terminal:["define",{sourceInterval:[1493,1531]},null,[],["seq",{sourceInterval:[1508,1531]},["terminal",{sourceInterval:[1508,1512]},'"'],["star",{sourceInterval:[1513,1526]},["app",{sourceInterval:[1513,1525]},"terminalChar",[]]],["terminal",{sourceInterval:[1527,1531]},'"']]],oneCharTerminal:["define",{sourceInterval:[1535,1579]},null,[],["seq",{sourceInterval:[1557,1579]},["terminal",{sourceInterval:[1557,1561]},'"'],["app",{sourceInterval:[1562,1574]},"terminalChar",[]],["terminal",{sourceInterval:[1575,1579]},'"']]],terminalChar:["define",{sourceInterval:[1583,1660]},null,[],["alt",{sourceInterval:[1602,1660]},["app",{sourceInterval:[1602,1612]},"escapeChar",[]],["seq",{sourceInterval:[1621,1660]},["not",{sourceInterval:[1621,1626]},["terminal",{sourceInterval:[1622,1626]},"\\"]],["not",{sourceInterval:[1627,1632]},["terminal",{sourceInterval:[1628,1632]},'"']],["not",{sourceInterval:[1633,1638]},["terminal",{sourceInterval:[1634,1638]},`
`]],["range",{sourceInterval:[1639,1660]},"\0","􏿿"]]]],escapeChar_backslash:["define",{sourceInterval:[1703,1758]},null,[],["terminal",{sourceInterval:[1703,1709]},"\\\\"]],escapeChar_doubleQuote:["define",{sourceInterval:[1765,1822]},null,[],["terminal",{sourceInterval:[1765,1771]},'\\"']],escapeChar_singleQuote:["define",{sourceInterval:[1829,1886]},null,[],["terminal",{sourceInterval:[1829,1835]},"\\'"]],escapeChar_backspace:["define",{sourceInterval:[1893,1948]},null,[],["terminal",{sourceInterval:[1893,1898]},"\\b"]],escapeChar_lineFeed:["define",{sourceInterval:[1955,2009]},null,[],["terminal",{sourceInterval:[1955,1960]},"\\n"]],escapeChar_carriageReturn:["define",{sourceInterval:[2016,2076]},null,[],["terminal",{sourceInterval:[2016,2021]},"\\r"]],escapeChar_tab:["define",{sourceInterval:[2083,2132]},null,[],["terminal",{sourceInterval:[2083,2088]},"\\t"]],escapeChar_unicodeCodePoint:["define",{sourceInterval:[2139,2243]},null,[],["seq",{sourceInterval:[2139,2221]},["terminal",{sourceInterval:[2139,2145]},"\\u{"],["app",{sourceInterval:[2146,2154]},"hexDigit",[]],["opt",{sourceInterval:[2155,2164]},["app",{sourceInterval:[2155,2163]},"hexDigit",[]]],["opt",{sourceInterval:[2165,2174]},["app",{sourceInterval:[2165,2173]},"hexDigit",[]]],["opt",{sourceInterval:[2188,2197]},["app",{sourceInterval:[2188,2196]},"hexDigit",[]]],["opt",{sourceInterval:[2198,2207]},["app",{sourceInterval:[2198,2206]},"hexDigit",[]]],["opt",{sourceInterval:[2208,2217]},["app",{sourceInterval:[2208,2216]},"hexDigit",[]]],["terminal",{sourceInterval:[2218,2221]},"}"]]],escapeChar_unicodeEscape:["define",{sourceInterval:[2250,2309]},null,[],["seq",{sourceInterval:[2250,2291]},["terminal",{sourceInterval:[2250,2255]},"\\u"],["app",{sourceInterval:[2256,2264]},"hexDigit",[]],["app",{sourceInterval:[2265,2273]},"hexDigit",[]],["app",{sourceInterval:[2274,2282]},"hexDigit",[]],["app",{sourceInterval:[2283,2291]},"hexDigit",[]]]],escapeChar_hexEscape:["define",{sourceInterval:[2316,2371]},null,[],["seq",{sourceInterval:[2316,2339]},["terminal",{sourceInterval:[2316,2321]},"\\x"],["app",{sourceInterval:[2322,2330]},"hexDigit",[]],["app",{sourceInterval:[2331,2339]},"hexDigit",[]]]],escapeChar:["define",{sourceInterval:[1664,2371]},"an escape sequence",[],["alt",{sourceInterval:[1703,2371]},["app",{sourceInterval:[1703,1709]},"escapeChar_backslash",[]],["app",{sourceInterval:[1765,1771]},"escapeChar_doubleQuote",[]],["app",{sourceInterval:[1829,1835]},"escapeChar_singleQuote",[]],["app",{sourceInterval:[1893,1898]},"escapeChar_backspace",[]],["app",{sourceInterval:[1955,1960]},"escapeChar_lineFeed",[]],["app",{sourceInterval:[2016,2021]},"escapeChar_carriageReturn",[]],["app",{sourceInterval:[2083,2088]},"escapeChar_tab",[]],["app",{sourceInterval:[2139,2221]},"escapeChar_unicodeCodePoint",[]],["app",{sourceInterval:[2250,2291]},"escapeChar_unicodeEscape",[]],["app",{sourceInterval:[2316,2339]},"escapeChar_hexEscape",[]]]],space:["extend",{sourceInterval:[2375,2394]},null,[],["app",{sourceInterval:[2387,2394]},"comment",[]]],comment_singleLine:["define",{sourceInterval:[2412,2458]},null,[],["seq",{sourceInterval:[2412,2443]},["terminal",{sourceInterval:[2412,2416]},"//"],["star",{sourceInterval:[2417,2429]},["seq",{sourceInterval:[2418,2427]},["not",{sourceInterval:[2418,2423]},["terminal",{sourceInterval:[2419,2423]},`
`]],["app",{sourceInterval:[2424,2427]},"any",[]]]],["lookahead",{sourceInterval:[2430,2443]},["alt",{sourceInterval:[2432,2442]},["terminal",{sourceInterval:[2432,2436]},`
`],["app",{sourceInterval:[2439,2442]},"end",[]]]]]],comment_multiLine:["define",{sourceInterval:[2465,2501]},null,[],["seq",{sourceInterval:[2465,2487]},["terminal",{sourceInterval:[2465,2469]},"/*"],["star",{sourceInterval:[2470,2482]},["seq",{sourceInterval:[2471,2480]},["not",{sourceInterval:[2471,2476]},["terminal",{sourceInterval:[2472,2476]},"*/"]],["app",{sourceInterval:[2477,2480]},"any",[]]]],["terminal",{sourceInterval:[2483,2487]},"*/"]]],comment:["define",{sourceInterval:[2398,2501]},null,[],["alt",{sourceInterval:[2412,2501]},["app",{sourceInterval:[2412,2443]},"comment_singleLine",[]],["app",{sourceInterval:[2465,2487]},"comment_multiLine",[]]]],tokens:["define",{sourceInterval:[2505,2520]},null,[],["star",{sourceInterval:[2514,2520]},["app",{sourceInterval:[2514,2519]},"token",[]]]],token:["define",{sourceInterval:[2524,2600]},null,[],["alt",{sourceInterval:[2532,2600]},["app",{sourceInterval:[2532,2540]},"caseName",[]],["app",{sourceInterval:[2543,2550]},"comment",[]],["app",{sourceInterval:[2553,2558]},"ident",[]],["app",{sourceInterval:[2561,2569]},"operator",[]],["app",{sourceInterval:[2572,2583]},"punctuation",[]],["app",{sourceInterval:[2586,2594]},"terminal",[]],["app",{sourceInterval:[2597,2600]},"any",[]]]],operator:["define",{sourceInterval:[2604,2669]},null,[],["alt",{sourceInterval:[2615,2669]},["terminal",{sourceInterval:[2615,2619]},"<:"],["terminal",{sourceInterval:[2622,2625]},"="],["terminal",{sourceInterval:[2628,2632]},":="],["terminal",{sourceInterval:[2635,2639]},"+="],["terminal",{sourceInterval:[2642,2645]},"*"],["terminal",{sourceInterval:[2648,2651]},"+"],["terminal",{sourceInterval:[2654,2657]},"?"],["terminal",{sourceInterval:[2660,2663]},"~"],["terminal",{sourceInterval:[2666,2669]},"&"]]],punctuation:["define",{sourceInterval:[2673,2709]},null,[],["alt",{sourceInterval:[2687,2709]},["terminal",{sourceInterval:[2687,2690]},"<"],["terminal",{sourceInterval:[2693,2696]},">"],["terminal",{sourceInterval:[2699,2702]},","],["terminal",{sourceInterval:[2705,2709]},"--"]]]}]),Jt=Object.create(v.prototype);function ke(s,t){for(let e in s)if(e===t)return!0;return!1}function Be(s,t,e){let r=new pt,n,i,o,l=!1;return(e||Yt).createSemantics().addOperation("visit",{Grammars(c){return c.children.map(h=>h.visit())},Grammar(c,h,f,m,y){let I=c.visit();n=r.newGrammar(I),h.child(0)&&h.child(0).visit(),m.children.map(J=>J.visit());let S=n.build();if(S.source=this.source.trimmed(),ke(t,I))throw os(S);return t[I]=S,S},SuperGrammar(c,h){let f=h.visit();if(f==="null")n.withSuperGrammar(null);else{if(!t||!ke(t,f))throw is(f,t,h.source);n.withSuperGrammar(t[f])}},Rule_define(c,h,f,m,y){i=c.visit(),o=h.children.map(it=>it.visit())[0]||[],!n.defaultStartRule&&n.ensureSuperGrammar()!==D.ProtoBuiltInRules&&n.withDefaultStartRule(i);let I=y.visit(),S=f.children.map(it=>it.visit())[0],J=this.source.trimmed();return n.define(i,o,I,S,J)},Rule_override(c,h,f,m){i=c.visit(),o=h.children.map(S=>S.visit())[0]||[];let y=this.source.trimmed();n.ensureSuperGrammarRuleForOverriding(i,y),l=!0;let I=m.visit();return l=!1,n.override(i,o,I,null,y)},Rule_extend(c,h,f,m){i=c.visit(),o=h.children.map(S=>S.visit())[0]||[];let y=m.visit(),I=this.source.trimmed();return n.extend(i,o,y,null,I)},RuleBody(c,h){return r.alt(...h.visit()).withSource(this.source)},OverrideRuleBody(c,h){let f=h.visit(),m=f.indexOf(Jt);if(m>=0){let y=f.slice(0,m),I=f.slice(m+1);return I.forEach(S=>{if(S===Jt)throw gs(S)}),new lt(n.superGrammar,i,y,I).withSource(this.source)}else return r.alt(...f).withSource(this.source)},Formals(c,h,f){return h.visit()},Params(c,h,f){return h.visit()},Alt(c){return r.alt(...c.visit()).withSource(this.source)},TopLevelTerm_inline(c,h){let f=i+"_"+h.visit(),m=c.visit(),y=this.source.trimmed(),I=!(n.superGrammar&&n.superGrammar.rules[f]);l&&!I?n.override(f,o,m,null,y):n.define(f,o,m,null,y);let S=o.map(J=>r.app(J));return r.app(f,S).withSource(m.source)},OverrideTopLevelTerm_superSplice(c){return Jt},Seq(c){return r.seq(...c.children.map(h=>h.visit())).withSource(this.source)},Iter_star(c,h){return r.star(c.visit()).withSource(this.source)},Iter_plus(c,h){return r.plus(c.visit()).withSource(this.source)},Iter_opt(c,h){return r.opt(c.visit()).withSource(this.source)},Pred_not(c,h){return r.not(h.visit()).withSource(this.source)},Pred_lookahead(c,h){return r.lookahead(h.visit()).withSource(this.source)},Lex_lex(c,h){return r.lex(h.visit()).withSource(this.source)},Base_application(c,h){let f=h.children.map(m=>m.visit())[0]||[];return r.app(c.visit(),f).withSource(this.source)},Base_range(c,h,f){return r.range(c.visit(),f.visit()).withSource(this.source)},Base_terminal(c){return r.terminal(c.visit()).withSource(this.source)},Base_paren(c,h,f){return h.visit()},ruleDescr(c,h,f){return h.visit()},ruleDescrText(c){return this.sourceString.trim()},caseName(c,h,f,m,y){return f.visit()},name(c,h){return this.sourceString},nameFirst(c){},nameRest(c){},terminal(c,h,f){return h.children.map(m=>m.visit()).join("")},oneCharTerminal(c,h,f){return h.visit()},escapeChar(c){try{return fe(this.sourceString)}catch(h){throw h instanceof RangeError&&h.message.startsWith("Invalid code point ")?ys(c):h}},NonemptyListOf(c,h,f){return[c.visit()].concat(f.children.map(m=>m.visit()))},EmptyListOf(){return[]},_terminal(){return this.sourceString}})(s).visit()}var ks=Ht(["grammar",{source:`OperationsAndAttributes {

  AttributeSignature =
    name

  OperationSignature =
    name Formals?

  Formals
    = "(" ListOf<name, ","> ")"

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

}`},"OperationsAndAttributes",null,"AttributeSignature",{AttributeSignature:["define",{sourceInterval:[29,58]},null,[],["app",{sourceInterval:[54,58]},"name",[]]],OperationSignature:["define",{sourceInterval:[62,100]},null,[],["seq",{sourceInterval:[87,100]},["app",{sourceInterval:[87,91]},"name",[]],["opt",{sourceInterval:[92,100]},["app",{sourceInterval:[92,99]},"Formals",[]]]]],Formals:["define",{sourceInterval:[104,143]},null,[],["seq",{sourceInterval:[118,143]},["terminal",{sourceInterval:[118,121]},"("],["app",{sourceInterval:[122,139]},"ListOf",[["app",{sourceInterval:[129,133]},"name",[]],["terminal",{sourceInterval:[135,138]},","]]],["terminal",{sourceInterval:[140,143]},")"]]],name:["define",{sourceInterval:[147,187]},"a name",[],["seq",{sourceInterval:[168,187]},["app",{sourceInterval:[168,177]},"nameFirst",[]],["star",{sourceInterval:[178,187]},["app",{sourceInterval:[178,186]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[191,223]},null,[],["alt",{sourceInterval:[207,223]},["terminal",{sourceInterval:[207,210]},"_"],["app",{sourceInterval:[217,223]},"letter",[]]]],nameRest:["define",{sourceInterval:[227,257]},null,[],["alt",{sourceInterval:[242,257]},["terminal",{sourceInterval:[242,245]},"_"],["app",{sourceInterval:[252,257]},"alnum",[]]]]}]);Bs(D.BuiltInRules);js(ks);function Bs(s){let t={empty(){return this.iteration()},nonEmpty(e,r,n){return this.iteration([e].concat(n.children))}};G.BuiltInSemantics=G.createSemantics(s,null).addOperation("asIteration",{emptyListOf:t.empty,nonemptyListOf:t.nonEmpty,EmptyListOf:t.empty,NonemptyListOf:t.nonEmpty})}function js(s){G.prototypeGrammarSemantics=s.createSemantics().addOperation("parse",{AttributeSignature(t){return{name:t.parse(),formals:[]}},OperationSignature(t,e){return{name:t.parse(),formals:e.children.map(r=>r.parse())[0]||[]}},Formals(t,e,r){return e.asIteration().children.map(n=>n.parse())},name(t,e){return this.sourceString}}),G.prototypeGrammar=s}function Gs(s){let t=0,e=[0],r=()=>e[e.length-1],n={},i=/( *).*(?:$|\r?\n|\r)/g,o;for(;(o=i.exec(s))!=null;){let[l,u]=o;if(l.length===0)break;let d=u.length,c=r(),h=t+d;if(d>c)e.push(d),n[h]=1;else if(d<c){let f=e.length;for(;r()!==d;)e.pop();n[h]=-1*(f-e.length)}t+=l.length}return e.length>1&&(n[t]=1-e.length),n}var je="an indented block",Ge="a dedent",$e=1114111+1,qe=class extends ut{constructor(t){super(t.input);this.state=t}_indentationAt(t){return this.state.userData[t]||0}atEnd(){return super.atEnd()&&this._indentationAt(this.pos)===0}next(){if(this._indentationAt(this.pos)!==0){this.examinedLength=Math.max(this.examinedLength,this.pos);return}return super.next()}nextCharCode(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),$e):super.nextCharCode()}nextCodePoint(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),$e):super.nextCodePoint()}},Zt=class extends v{constructor(t=!0){super();this.isIndent=t}allowsSkippingPrecedingSpace(){return!0}eval(t){let{inputStream:e}=t,r=t.userData;t.doNotMemoize=!0;let n=e.pos,i=this.isIndent?1:-1;return(r[n]||0)*i>0?(t.userData=Object.create(r),t.userData[n]-=i,t.pushBinding(new Y(0),n),!0):(t.processFailure(n,this),!1)}getArity(){return 1}_assertAllApplicationsAreValid(t,e){}_isNullable(t,e){return!1}assertChoicesHaveUniformArity(t){}assertIteratedExprsAreNotNullable(t){}introduceParams(t){return this}substituteParams(t){return this}toString(){return this.isIndent?"indent":"dedent"}toDisplayString(){return this.toString()}toFailure(t){let e=this.isIndent?je:Ge;return new j(this,e,"description")}},$s=new x("indent"),qs=new x("dedent"),Ks=new lt(Xt,"any",[$s,qs],[]),zs=new pt().newGrammar("IndentationSensitive").withSuperGrammar(Xt).define("indent",[],new Zt(!0),je,void 0,!0).define("dedent",[],new Zt(!1),Ge,void 0,!0).extend("any",[],Ks,"any character",void 0).build();Object.assign(zs,{_matchStateInitializer(s){s.userData=Gs(s.input),s.inputStream=new qe(s)},supportsIncrementalParsing:!1});D.initApplicationParser(Yt,Be);var Us=s=>!!s.constructor&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s);function Ws(s,t){let e=Yt.match(s,"Grammars");if(e.failed())throw ns(e);return Be(e,t)}function Ke(s,t){let e=Vs(s,t),r=Object.keys(e);if(r.length===0)throw new Error("Missing grammar definition");if(r.length>1){let i=e[r[1]].source;throw new Error(jt(i.sourceString,i.startIdx)+"Found more than one grammar definition -- use ohm.grammars() instead.")}return e[r[0]]}function Vs(s,t){let e=Object.create(t||{});if(typeof s!="string")if(Us(s))s=s.toString();else throw new TypeError("Expected string as first argument, got "+Dt(s));return Ws(s,e),e}var ze=Ke(String.raw`
  Constraints {
    Label = Expr | ident

    Expr = number ident -- times
         | number       -- const

    number = digit+ ("." digit+)? -- wholeAndFrac
           | "." digit+           -- onlyFrac

    ident = letter alnum*
  }
`),Hs=ze.createSemantics().addOperation("parse",{Expr_times(s,t){return{operator:"*",args:[s.parse(),t.parse()]}},number(s){return parseFloat(this.sourceString)},ident(s,t){return this.sourceString}});function Xs(s){try{let t=ze.match(s);return Hs(t).parse()}catch(t){return null}}var Ue=Xs;var We=0,dt=class{constructor(t){this.id=We++,this.pos=t||g()}render(t){t.beginPath(),t.ellipse(this.pos.x,this.pos.y,3,3,0,0,Math.PI*2),t.fill()}};function Ys(){let s=document.createElement("input");return s.setAttribute("type","text"),s.contentEditable=!0,s.onchange=()=>{s.value=s.value.toLowerCase(),s.blur()},s.setPos=(t,e)=>{let r=s.getBoundingClientRect();s.style.setProperty("left",`${t-r.width/2}px`),s.style.setProperty("top",`${e-r.height/2}px`)},document.body.appendChild(s),s}var Qt=class{constructor(t,e){this.id=We++,this.a=t,this.b=e,this.input=Ys(),this.updateInputPos()}render(t,e){t.lineWidth=1,t.strokeStyle=e?"#F81ED5":"#000000",t.beginPath(),t.moveTo(this.a.pos.x,this.a.pos.y),t.lineTo(this.b.pos.x,this.b.pos.y),t.stroke(),this.updateInputPos()}updateInputPos(){this.input.setPos((this.a.pos.x+this.b.pos.x)/2,(this.a.pos.y+this.b.pos.y)/2)}},Ve=class{constructor(t){this.a=t,this.b=g.clone(t),this.last_b=g.clone(t),this.velocity=0,this.h_snap,this.v_snap,this.ref_line,this.angle_snap,this.angle_offset,this.len_snap,this.point_snap}update(t,e,r){this.b=t;let n=g.dist(this.last_b,this.b);this.last_b=g.clone(this.b),this.velocity=.05*n+(1-.05)*this.velocity,this.h_snap=!1,this.v_snap=!1,Math.abs(this.a.x-this.b.x)<10&&(this.b.x=this.a.x,this.v_snap=!0),Math.abs(this.a.y-this.b.y)<10&&(this.b.y=this.a.y,this.h_snap=!0);let i=[];this.velocity<1.5&&(e.forEach(l=>{let u=K.getXforY(this,l.pos.y),d=K.getYforX(this,l.pos.x);i.push({type:"horizontal",x:u,y:l.pos.y,snap:l},{type:"vertical",x:l.pos.x,y:d,snap:l})}),this.point_snap=!1,i.forEach(l=>{g.dist(t,l)<10&&(this.b.x=l.x,this.b.y=l.y,this.point_snap=l)}));let o=e.find(l=>g.dist(l.pos,t)<10);if(o&&(this.b=o.pos,this.point_snap={type:"coincident",snap:o}),this.len_snap=!1,this.angle_snap=!1,this.angle_offset=null,r){this.ref_line=r;let l=K.len(K(r.a.pos,r.b.pos)),u=K.len(K(this.a,this.b));Math.abs(l-u)<10&&(this.b=g.add(this.a,g.mulS(g.normalize(g.sub(this.b,this.a)),l)),this.len_snap=!0,u=l);let d=g.sub(this.a,this.b),c=g.sub(r.a.pos,r.b.pos),h=g.angle(d),f=g.angle(c),m=(h-f+360)%360,y=(Math.round(m/90)*90+360)%360;if(Math.abs(m-y)<10){let I=f+y;this.b=g.add(this.a,g.polar(180+I,u)),this.angle_snap=!0,this.angle_offset=y}}}render(t){if(t.lineWidth=1,t.strokeStyle=this.len_snap?"#F81ED5":"#000000",t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.stroke(),this.h_snap||this.v_snap||this.angle_snap){let e=g.add(this.b,g.mulS(g.sub(this.a,this.b),100)),r=g.add(this.a,g.mulS(g.sub(this.b,this.a),100));t.lineWidth=.25,t.strokeStyle="#F81ED5",t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(r.x,r.y),t.stroke()}if(this.point_snap){let e=g.add(this.b,g.mulS(g.sub(this.point_snap.snap.pos,this.b),100)),r=g.add(this.point_snap.snap.pos,g.mulS(g.sub(this.b,this.point_snap.snap.pos),100));t.lineWidth=.25,t.strokeStyle="#F81ED5",t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(r.x,r.y),t.stroke()}if(this.ref_line){let e=K.len(K(this.ref_line.a.pos,this.ref_line.b.pos)),r=g.normalize(g.sub(this.b,this.a)),n=g.add(this.a,g.mulS(r,1e4)),i=g.mulS(r,e);t.lineWidth=.25,t.strokeStyle="#F81ED5",t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(n.x,n.y),t.stroke();for(let o=0;o<10;o+=.25){let l=o%1==0?6:3,u=g.mulS(g.rotate90CCW(r),l),d=g.add(this.a,g.mulS(i,o)),c=g.add(d,u),h=g.sub(d,u);t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(h.x,h.y),t.stroke()}}}},He=class{constructor(){this.mode="draw",this.wet_stroke=null,this.ref_line=null,this.points=[],this.lines=[],this.constraints=[],this.___addLine({x:100,y:100},{x:300,y:200}),this.___addLine({x:150,y:150},{x:150,y:400})}find_point_near(t){return this.points.find(e=>g.dist(e.pos,t)<10)}find_stroke_near(t){return this.lines.find(e=>K.distToPoint(K(e.a.pos,e.b.pos),t)<20)}begin_stroke(t){let e=this.find_point_near(t);e&&(t=e.pos),this.wet_stroke=new Ve(t)}update_stroke(t){this.wet_stroke&&this.wet_stroke.update(t,this.points,this.ref_line)}___addLine(t,e){let r=new dt(t),n=new dt(e);this.points.push(r,n);let i=new Qt(r,n);this.lines.push(i)}end_stroke(t){let e=this.find_point_near(this.wet_stroke.a);e||(e=new dt(this.wet_stroke.a)),this.points.push(e);let r=this.find_point_near(this.wet_stroke.b);r||(r=new dt(this.wet_stroke.b)),this.points.push(r);let n=new Qt(e,r);this.lines.push(n),this.constraints.push({type:"minLength",a:n,b:50});let i=this.wet_stroke;i.v_snap&&this.constraints.push({type:"vertical",a:e,b:r}),i.h_snap&&this.constraints.push({type:"horizontal",a:e,b:r}),i.point_snap&&i.point_snap.type!="coincident"&&this.constraints.push({type:i.point_snap.type,a:r,b:i.point_snap.snap}),i.len_snap&&this.constraints.push({type:"length",a:n,b:i.ref_line}),i.angle_snap&&!i.v_snap&&!i.h_snap&&this.constraints.push({type:"angle",a:n,b:i.ref_line,angle:i.angle_offset}),this.wet_stroke=null}update(t){t.pencil.forEach(e=>{let r=g(e.x,e.y);if(this.mode==="draw")e.type==="began"?this.begin_stroke(r):e.type==="moved"?this.update_stroke(r):e.type==="ended"&&this.end_stroke(r);else if(this.mode.startsWith("move")){if(e.type==="began"&&(this.dragging=this.find_point_near(r),this.dragging)){let n=-Infinity;for(let i of this.points){let o=g.dist(this.dragging.pos,i.pos);o>n&&(n=o,this.fixedPoint=i)}}e.type==="moved"&&this.dragging&&(this.dragging.pos=r),e.type==="ended"&&(this.dragging=!1,this.fixedPoint=null)}}),Object.entries(t.touches).forEach(([e,r])=>{r.forEach(n=>{let i=g(n.x,n.y);if(n.type==="began"){let o=this.find_stroke_near(i);this.ref_line===o?this.ref_line=null:(this.ref_line=o,this.finger_down_time=n.timestamp),this.ref_line_id=e,g.dist(g(40,40),i)<20&&this.toggleModes()}n.type=="ended"&&n.timestamp-this.finger_down_time>1&&(this.ref_line=null)})})}toggleModes(){if(this.mode==="draw")this.mode="move";else if(this.mode==="move")this.mode="move-v2";else if(this.mode==="move-v2"){this.mode="scribble";for(let t of document.body.getElementsByTagName("input"))t.placeholder="...";window.webkit.messageHandlers.messages.postMessage("mgr off")}else{let t=[];for(let e of document.body.getElementsByTagName("input")){e.placeholder="",e.blur();let r=Ue(e.value);r!=null&&t.push(r)}console.log(t),this.mode="draw",window.webkit.messageHandlers.messages.postMessage("mgr on")}return document.body.className=this.mode,this.mode}render(t){this.lines.forEach(e=>{e.render(t,e===this.ref_line)}),this.points.forEach(e=>{e.render(t)}),this.wet_stroke&&this.wet_stroke.render(t),t.beginPath(),t.ellipse(40,40,20,20,0,0,Math.PI*2),this.mode==="draw"?t.fill():t.stroke(),t.fillText(this.mode,70,40)}},Xe=He;var W=new Xe,Ye=new ne(document.body,s=>{s.clearRect(0,0,window.innerWidth,window.innerHeight),W.render(s)});Ye.canvas.addEventListener("touchstart",s=>{W.mode==="scribble"&&s.pageX<=50&&s.pageY<=50&&W.toggleModes()});se(s=>{W.update(s),Js(),Ye.render()});function Js(){let s=new ie;Zs(s);for(let t of W.constraints)Qs(s,t);s.iterateForUpToMillis(15)}function Zs(s){if(!W.mode.startsWith("move")||!W.dragging)return;function t(e){let r=$(e.pos);e.pos=r,s.add(new At(r,new M(r.x,r.y)))}t(W.dragging),W.mode==="move-v2"&&t(W.fixedPoint)}function Qs(s,t){if(t.type==="vertical"&&(t.a.pos=$(t.a.pos),t.b.pos=$(t.b.pos),s.add(new Ot(t.a.pos,t.b.pos))),t.type==="horizontal"&&(t.a.pos=$(t.a.pos),t.b.pos=$(t.b.pos),s.add(new Lt(t.a.pos,t.b.pos))),t.type==="length"){t.a.a.pos=$(t.a.a.pos),t.a.b.pos=$(t.a.b.pos),t.b.a.pos=$(t.b.a.pos),t.b.b.pos=$(t.b.b.pos);let e=new St(t.a.a.pos.distanceTo(t.a.b.pos));s.add(new mt(t.a.a.pos,t.a.b.pos,e)),s.add(new mt(t.b.a.pos,t.b.b.pos,e))}t.type==="minLength"&&(t.a.a.pos=$(t.a.a.pos),t.a.b.pos=$(t.a.b.pos),s.add(new Rt(t.a.a.pos,t.a.b.pos,t.b))),t.type==="angle"&&(t.a.a.pos=$(t.a.a.pos),t.a.b.pos=$(t.a.b.pos),t.b.a.pos=$(t.b.a.pos),t.b.b.pos=$(t.b.b.pos),s.add(new Et(t.a.a.pos,t.a.b.pos,t.b.a.pos,t.b.b.pos,Math.PI*t.angle/180)))}function $(s){return s instanceof M?s:new M(s.x,s.y)}
//# sourceMappingURL=main.js.map
